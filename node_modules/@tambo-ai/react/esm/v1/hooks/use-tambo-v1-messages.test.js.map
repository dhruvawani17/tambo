{"version":3,"file":"use-tambo-v1-messages.test.js","sourceRoot":"","sources":["../../../src/v1/hooks/use-tambo-v1-messages.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  EventType,\n  type TextMessageStartEvent,\n  type TextMessageContentEvent,\n  type TextMessageEndEvent,\n} from \"@ag-ui/core\";\nimport { renderHook, act } from \"@testing-library/react\";\nimport React from \"react\";\nimport {\n  TamboV1StreamProvider,\n  useStreamDispatch,\n} from \"../providers/tambo-v1-stream-context\";\nimport { useTamboV1Messages } from \"./use-tambo-v1-messages\";\n\ndescribe(\"useTamboV1Messages\", () => {\n  function TestWrapper({ children }: { children: React.ReactNode }) {\n    return <TamboV1StreamProvider>{children}</TamboV1StreamProvider>;\n  }\n\n  it(\"returns empty messages when thread has no messages\", () => {\n    const { result } = renderHook(\n      () => ({\n        messages: useTamboV1Messages(\"thread_123\"),\n        dispatch: useStreamDispatch(),\n      }),\n      { wrapper: TestWrapper },\n    );\n\n    // Initialize thread first\n    act(() => {\n      result.current.dispatch({ type: \"INIT_THREAD\", threadId: \"thread_123\" });\n    });\n\n    expect(result.current.messages.messages).toEqual([]);\n    expect(result.current.messages.hasMessages).toBe(false);\n    expect(result.current.messages.messageCount).toBe(0);\n    expect(result.current.messages.lastMessage).toBeUndefined();\n    expect(result.current.messages.userMessages).toEqual([]);\n    expect(result.current.messages.assistantMessages).toEqual([]);\n  });\n\n  it(\"returns messages after events are dispatched\", () => {\n    const { result } = renderHook(\n      () => ({\n        messages: useTamboV1Messages(\"thread_123\"),\n        dispatch: useStreamDispatch(),\n      }),\n      { wrapper: TestWrapper },\n    );\n\n    // Initialize thread first\n    act(() => {\n      result.current.dispatch({ type: \"INIT_THREAD\", threadId: \"thread_123\" });\n    });\n\n    // Simulate a text message being received\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_START,\n          messageId: \"msg_1\",\n          role: \"assistant\",\n        } as TextMessageStartEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_CONTENT,\n          messageId: \"msg_1\",\n          delta: \"Hello\",\n        } as TextMessageContentEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_END,\n          messageId: \"msg_1\",\n        } as TextMessageEndEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    expect(result.current.messages.messages.length).toBe(1);\n    expect(result.current.messages.hasMessages).toBe(true);\n    expect(result.current.messages.messageCount).toBe(1);\n    expect(result.current.messages.lastMessage?.id).toBe(\"msg_1\");\n    expect(result.current.messages.lastMessage?.role).toBe(\"assistant\");\n    expect(result.current.messages.assistantMessages.length).toBe(1);\n    expect(result.current.messages.userMessages.length).toBe(0);\n  });\n\n  it(\"filters user and assistant messages correctly\", () => {\n    const { result } = renderHook(\n      () => ({\n        messages: useTamboV1Messages(\"thread_123\"),\n        dispatch: useStreamDispatch(),\n      }),\n      { wrapper: TestWrapper },\n    );\n\n    // Initialize thread first\n    act(() => {\n      result.current.dispatch({ type: \"INIT_THREAD\", threadId: \"thread_123\" });\n    });\n\n    // Add user message\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_START,\n          messageId: \"msg_user\",\n          role: \"user\",\n        } as TextMessageStartEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_END,\n          messageId: \"msg_user\",\n        } as TextMessageEndEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    // Add assistant message\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_START,\n          messageId: \"msg_assistant\",\n          role: \"assistant\",\n        } as TextMessageStartEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    act(() => {\n      result.current.dispatch({\n        type: \"EVENT\",\n        event: {\n          type: EventType.TEXT_MESSAGE_END,\n          messageId: \"msg_assistant\",\n        } as TextMessageEndEvent,\n        threadId: \"thread_123\",\n      });\n    });\n\n    expect(result.current.messages.messageCount).toBe(2);\n    expect(result.current.messages.userMessages.length).toBe(1);\n    expect(result.current.messages.userMessages[0].id).toBe(\"msg_user\");\n    expect(result.current.messages.assistantMessages.length).toBe(1);\n    expect(result.current.messages.assistantMessages[0].id).toBe(\n      \"msg_assistant\",\n    );\n    expect(result.current.messages.lastMessage?.id).toBe(\"msg_assistant\");\n  });\n\n  it(\"returns empty messages when threadId does not exist in threadMap\", () => {\n    const { result } = renderHook(\n      () => useTamboV1Messages(\"nonexistent_thread\"),\n      {\n        wrapper: TestWrapper,\n      },\n    );\n\n    expect(result.current.messages).toEqual([]);\n    expect(result.current.hasMessages).toBe(false);\n    expect(result.current.messageCount).toBe(0);\n  });\n});\n"]}
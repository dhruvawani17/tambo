{"version":3,"file":"registry-conversion.js","sourceRoot":"","sources":["../../../src/v1/utils/registry-conversion.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Registry Conversion Utilities\n *\n * Converts beta SDK component/tool types to v1 API format.\n * Reuses the beta SDK's TamboRegistryProvider but provides conversion\n * utilities for sending component/tool metadata to the v1 API.\n */\n\nimport type { JSONSchema7 } from \"json-schema\";\nimport type {\n  TamboComponent,\n  TamboTool,\n  UnsupportedSchemaTamboTool,\n} from \"../../model/component-metadata\";\nimport { schemaToJsonSchema } from \"../../schema/schema\";\nimport type { RunCreateParams } from \"@tambo-ai/typescript-sdk/resources/threads/runs\";\n\n// Use the SDK's types for API requests\ntype AvailableComponent = RunCreateParams.AvailableComponent;\ntype Tool = RunCreateParams.Tool;\n\n/**\n * Convert a registered component to v1 API format.\n *\n * Transforms TamboComponent (beta SDK format with Standard Schema support)\n * to AvailableComponent (v1 API format requiring JSON Schema).\n * @param component - Component from beta SDK registry\n * @returns Component metadata in v1 API format\n * @throws {Error} if propsSchema conversion fails\n */\nexport function toAvailableComponent(\n  component: TamboComponent,\n): AvailableComponent {\n  // Convert propsSchema (required for v1)\n  if (!component.propsSchema) {\n    throw new Error(\n      `Component \"${component.name}\" missing propsSchema - required for v1 API`,\n    );\n  }\n\n  const propsSchema: JSONSchema7 = schemaToJsonSchema(component.propsSchema);\n\n  return {\n    name: component.name,\n    description: component.description,\n    propsSchema: propsSchema as Record<string, unknown>,\n    // stateSchema is v1-specific and not available in beta SDK components\n    // Components can still have state, but schema must be defined separately\n  };\n}\n\n/**\n * Convert multiple registered components to v1 API format.\n *\n * Transforms a Record/Map of TamboComponents to an array of AvailableComponents.\n * Components without propsSchema will be logged as warnings and skipped.\n * @param components - Record or Map of components from beta SDK registry\n * @returns Array of component metadata in v1 API format\n */\nexport function toAvailableComponents(\n  components: Record<string, TamboComponent> | Map<string, TamboComponent>,\n): AvailableComponent[] {\n  const results: AvailableComponent[] = [];\n\n  const entries =\n    components instanceof Map\n      ? Array.from(components.entries())\n      : Object.entries(components);\n\n  for (const [name, component] of entries) {\n    try {\n      results.push(toAvailableComponent(component));\n    } catch (error) {\n      console.warn(\n        `Skipping component \"${name}\" in v1 conversion: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  return results;\n}\n\n/**\n * Convert a registered tool to v1 API format.\n *\n * Transforms TamboTool or UnsupportedSchemaTamboTool (beta SDK format with\n * Standard Schema support) to Tool (v1 API format requiring JSON Schema).\n * Handles both new inputSchema and deprecated toolSchema formats.\n * @param tool - Tool from beta SDK registry\n * @returns Tool metadata in v1 API format\n * @throws {Error} if schema conversion fails or schema is missing\n */\nexport function toAvailableTool(\n  tool: TamboTool | UnsupportedSchemaTamboTool,\n): Tool {\n  // Check for inputSchema (modern format - required in TamboTool)\n  if (\"inputSchema\" in tool && tool.inputSchema) {\n    const inputSchema: JSONSchema7 = schemaToJsonSchema(tool.inputSchema);\n    return {\n      name: tool.name,\n      description: tool.description,\n      inputSchema: inputSchema as Record<string, unknown>,\n    };\n  }\n\n  // Check for deprecated toolSchema format (UnsupportedSchemaTamboTool)\n  if (\"toolSchema\" in tool && tool.toolSchema) {\n    const inputSchema: JSONSchema7 = schemaToJsonSchema(tool.toolSchema);\n    return {\n      name: tool.name,\n      description: tool.description,\n      inputSchema: inputSchema as Record<string, unknown>,\n    };\n  }\n\n  throw new Error(\n    `Tool \"${tool.name}\" missing inputSchema or toolSchema - required for v1 API`,\n  );\n}\n\n/**\n * Convert multiple registered tools to v1 API format.\n *\n * Transforms a Record/Map of TamboTools or UnsupportedSchemaTamboTool to an array\n * of Tools. Tools without inputSchema/toolSchema will be logged as warnings\n * and skipped.\n * @param tools - Record or Map of tools from beta SDK registry\n * @returns Array of tool metadata in v1 API format\n */\nexport function toAvailableTools(\n  tools:\n    | Record<string, TamboTool | UnsupportedSchemaTamboTool>\n    | Map<string, TamboTool | UnsupportedSchemaTamboTool>,\n): Tool[] {\n  const results: Tool[] = [];\n\n  const entries =\n    tools instanceof Map ? Array.from(tools.entries()) : Object.entries(tools);\n\n  for (const [name, tool] of entries) {\n    try {\n      results.push(toAvailableTool(tool));\n    } catch (error) {\n      console.warn(\n        `Skipping tool \"${name}\" in v1 conversion: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  return results;\n}\n"]}
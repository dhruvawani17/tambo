{"version":3,"file":"json-patch.js","sourceRoot":"","sources":["../../../src/v1/utils/json-patch.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;AAEH,OAAO,EAAE,UAAU,EAAkB,MAAM,iBAAiB,CAAC;AAE7D;;;;;;;;GAQG;AACH,MAAM,UAAU,cAAc,CAC5B,MAAS,EACT,UAAuB;IAEvB,IAAI,CAAC;QACH,qEAAqE;QACrE,MAAM,MAAM,GAAG,UAAU,CACvB,MAAM,EACN,UAAU;QACV,cAAc,CAAC,IAAI;QACnB,YAAY,CAAC,KAAK,CACnB,CAAC;QAEF,OAAO,MAAM,CAAC,WAAW,CAAC;IAC5B,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,MAAM,SAAS,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3E,MAAM,IAAI,KAAK,CACb,0CAA0C,SAAS,KAAK;YACtD,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI;YAC7D,qBAAqB,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CACzD,CAAC;IACJ,CAAC;AACH,CAAC","sourcesContent":["/**\n * JSON Patch Utilities (RFC 6902)\n *\n * Wrapper around fast-json-patch for applying JSON Patch operations.\n * Used to update component props and state during streaming.\n */\n\nimport { applyPatch, type Operation } from \"fast-json-patch\";\n\n/**\n * Apply JSON Patch operations to an object.\n *\n * Returns a new object with patches applied without mutating the original.\n * @param target - The object to patch\n * @param operations - Array of JSON Patch operations\n * @returns New object with patches applied\n * @throws {Error} With context about the failed operation if patching fails\n */\nexport function applyJsonPatch<T extends Record<string, unknown>>(\n  target: T,\n  operations: Operation[],\n): T {\n  try {\n    // Apply patches with mutate=false so fast-json-patch handles cloning\n    const result = applyPatch(\n      target,\n      operations,\n      /* validate */ true,\n      /* mutate */ false,\n    );\n\n    return result.newDocument;\n  } catch (error) {\n    const opSummary = operations.map((op) => `${op.op} ${op.path}`).join(\", \");\n    throw new Error(\n      `Failed to apply JSON patch operations [${opSummary}]: ` +\n        `${error instanceof Error ? error.message : String(error)}. ` +\n        `Target had keys: [${Object.keys(target).join(\", \")}]`,\n    );\n  }\n}\n"]}
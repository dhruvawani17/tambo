{"version":3,"file":"tambo-mcp-provider.test.js","sourceRoot":"","sources":["../../src/mcp/tambo-mcp-provider.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { RequestHandlerExtra } from \"@modelcontextprotocol/sdk/shared/protocol.js\";\nimport type {\n  ClientNotification,\n  ClientRequest,\n} from \"@modelcontextprotocol/sdk/types.js\";\nimport { render, waitFor } from \"@testing-library/react\";\nimport React, { useEffect } from \"react\";\nimport {\n  TamboClientContext,\n  useTamboClient,\n} from \"../providers/tambo-client-provider\";\nimport { TamboMcpTokenProvider } from \"../providers/tambo-mcp-token-provider\";\nimport {\n  TamboRegistryProvider,\n  useTamboRegistry,\n} from \"../providers/tambo-registry-provider\";\nimport { MCPClient, MCPTransport } from \"./mcp-client\";\nimport {\n  extractErrorMessage,\n  TamboMcpProvider,\n  useTamboMcpServers,\n  type McpServer,\n  type ProviderMCPHandlers,\n} from \"./tambo-mcp-provider\";\n\n// Import the private function for testing by re-exporting it for tests only\n// We'll need to export it temporarily or test it through public API\n\n// Helper to create mock RequestHandlerExtra for testing\nfunction createMockExtra(): RequestHandlerExtra<\n  ClientRequest,\n  ClientNotification\n> {\n  return {\n    signal: new AbortController().signal,\n    requestId: \"test-request-id\",\n    sendNotification: (async () => {}) as any,\n    sendRequest: (async () => ({ _meta: {} })) as any,\n  };\n}\n\n// Mock the MCP client to avoid ES module issues\njest.mock(\"./mcp-client\", () => ({\n  MCPClient: jest.fn(),\n  MCPTransport: {\n    SSE: \"sse\",\n    HTTP: \"http\",\n  },\n}));\n\n// Mock the registry provider to avoid dependency issues\njest.mock(\"../providers/tambo-registry-provider\", () => {\n  const actual = jest.requireActual(\"../providers/tambo-registry-provider\");\n  return {\n    ...actual,\n    useTamboRegistry: jest.fn(),\n  };\n});\n\n// Mock the client provider to avoid dependency issues\njest.mock(\"../providers/tambo-client-provider\", () => {\n  return {\n    useTamboClient: jest.fn(),\n    TamboClientContext: React.createContext(undefined),\n  };\n});\n\n// Helper to wrap tests with all required providers (used across multiple describe blocks)\nconst TestWrapper: React.FC<{\n  mcpServers: any;\n  handlers?: ProviderMCPHandlers;\n  children: React.ReactNode;\n}> = ({ mcpServers, handlers, children }) => {\n  const client = useTamboClient();\n  return (\n    <TamboClientContext.Provider\n      value={{\n        client,\n        queryClient: {} as any,\n        isUpdatingToken: false,\n      }}\n    >\n      <TamboRegistryProvider mcpServers={mcpServers}>\n        <TamboMcpTokenProvider>\n          <TamboMcpProvider handlers={handlers}>{children}</TamboMcpProvider>\n        </TamboMcpTokenProvider>\n      </TamboRegistryProvider>\n    </TamboClientContext.Provider>\n  );\n};\n\ndescribe(\"extractErrorMessage\", () => {\n  describe(\"Array content handling\", () => {\n    it(\"should extract text from array content with multiple text items\", () => {\n      const content = [\n        { type: \"text\", text: \"Error:\" },\n        { type: \"text\", text: \"Tool execution failed\" },\n        { type: \"image\", url: \"http://example.com/error.png\" }, // Should be filtered out\n      ];\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Error: Tool execution failed\");\n    });\n\n    it(\"should extract text from array content with single text item\", () => {\n      const content = [{ type: \"text\", text: \"Simple error message\" }];\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Simple error message\");\n    });\n\n    it(\"should return fallback message for array content with no text items\", () => {\n      const content = [\n        { type: \"image\", url: \"http://example.com/error.png\" },\n        { type: \"resource\", uri: \"file://error.log\" },\n      ];\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Error occurred but no details provided\");\n    });\n\n    it(\"should return fallback message for empty array content\", () => {\n      const content: any[] = [];\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Error occurred but no details provided\");\n    });\n\n    it(\"should handle array content with mixed types correctly\", () => {\n      const content = [\n        { type: \"resource\", uri: \"file://log.txt\" },\n        { type: \"text\", text: \"First error\" },\n        { type: \"image\", url: \"http://example.com/img.png\" },\n        { type: \"text\", text: \"Second error\" },\n        { type: \"unknown\", data: \"something\" },\n      ];\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"First error Second error\");\n    });\n\n    it(\"should handle array content with malformed items\", () => {\n      const content = [\n        null,\n        { type: \"text\", text: \"Valid error\" },\n        { type: \"text\" }, // Missing text property\n        { type: \"text\", text: null }, // Invalid text type\n        { type: \"text\", text: \"Another valid error\" },\n      ];\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Valid error Another valid error\");\n    });\n  });\n\n  describe(\"Non-array content handling\", () => {\n    it(\"should return string content as-is\", () => {\n      const content = \"Direct error message\";\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Direct error message\");\n    });\n\n    it(\"should handle null content\", () => {\n      const content = null;\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Unknown error occurred\");\n    });\n\n    it(\"should handle undefined content\", () => {\n      const content = undefined;\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"Unknown error occurred\");\n    });\n\n    it(\"should handle number content\", () => {\n      const content = 42;\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"42\");\n    });\n\n    it(\"should handle boolean content\", () => {\n      const content = false;\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"false\");\n    });\n\n    it(\"should handle object content\", () => {\n      const content = { error: \"Something went wrong\" };\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe('{\"error\":\"Something went wrong\"}');\n    });\n\n    it(\"should handle complex object content\", () => {\n      const content = {\n        error: \"Something went wrong\",\n        code: 500,\n        details: { message: \"Internal server error\" },\n      };\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\n        '{\"error\":\"Something went wrong\",\"code\":500,\"details\":{\"message\":\"Internal server error\"}}',\n      );\n    });\n\n    it(\"should handle empty object content\", () => {\n      const content = {};\n\n      const result = extractErrorMessage(content);\n\n      expect(result).toBe(\"{}\");\n    });\n  });\n});\n\ndescribe(\"TamboMcpProvider server list changes\", () => {\n  beforeEach(() => {\n    // Mock registry so tool registration is a no-op\n    (useTamboRegistry as unknown as jest.Mock).mockReturnValue({\n      registerTool: jest.fn(),\n    });\n\n    // Mock client with baseURL\n    (useTamboClient as unknown as jest.Mock).mockReturnValue({\n      baseURL: \"https://api.tambo.co\",\n    });\n\n    // Ensure MCPClient.create exists and returns a fake client with listTools and close\n    (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n      listTools: jest.fn().mockResolvedValue([]),\n      close: jest.fn(),\n    });\n  });\n\n  const Capture: React.FC<{ onUpdate: (servers: McpServer[]) => void }> = ({\n    onUpdate,\n  }) => {\n    const servers = useTamboMcpServers();\n    useEffect(() => {\n      onUpdate(servers);\n    }, [servers, onUpdate]);\n    return <div data-testid=\"urls\">{servers.map((s) => s.url).join(\",\")}</div>;\n  };\n\n  it(\"adds a new server when the list grows\", async () => {\n    let latest: McpServer[] = [];\n    const { rerender, getByTestId } = render(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider mcpServers={[\"https://a.example\"]}>\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    // Wait for initial connection\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Add new server\n    rerender(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider\n          mcpServers={[\"https://a.example\", \"https://b.example\"]}\n        >\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n      const urls = getByTestId(\"urls\").textContent || \"\";\n      expect(urls).toContain(\"https://a.example\");\n      expect(urls).toContain(\"https://b.example\");\n    });\n  });\n\n  it(\"removes a server when the list shrinks\", async () => {\n    let latest: McpServer[] = [];\n    const { rerender, getByTestId } = render(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider\n          mcpServers={[\"https://a.example\", \"https://b.example\"]}\n        >\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n    });\n\n    // Remove one server\n    rerender(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider mcpServers={[\"https://a.example\"]}>\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n      const urls = getByTestId(\"urls\").textContent || \"\";\n      expect(urls).toContain(\"https://a.example\");\n      expect(urls).not.toContain(\"https://b.example\");\n    });\n  });\n\n  it(\"does not duplicate when a new copy of the same list is passed\", async () => {\n    let latest: McpServer[] = [];\n    const initial = [\n      { url: \"https://a.example\", transport: MCPTransport.SSE },\n      { url: \"https://b.example\", transport: MCPTransport.SSE },\n    ];\n\n    const { rerender } = render(\n      <TestWrapper mcpServers={initial}>\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n    });\n\n    // Pass a new array instance with the same logical servers\n    const same = [\n      { url: \"https://a.example\", transport: MCPTransport.SSE },\n      { url: \"https://b.example\", transport: MCPTransport.SSE },\n    ];\n    rerender(\n      <TestWrapper mcpServers={same}>\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n      const urls = latest.map((s) => s.url).sort();\n      expect(urls).toEqual([\"https://a.example\", \"https://b.example\"].sort());\n    });\n  });\n\n  it(\"forwards maxCalls from MCP listTools to registry.registerTool\", async () => {\n    const registerToolMock = jest.fn();\n\n    // Mock registry to capture registerTool calls\n    (useTamboRegistry as unknown as jest.Mock).mockReturnValue({\n      registerTool: registerToolMock,\n    });\n\n    // Mock client\n    (useTamboClient as unknown as jest.Mock).mockReturnValue({\n      baseURL: \"https://api.tambo.co\",\n    });\n\n    // Prepare MCP client to return a tool with maxCalls in its metadata\n    (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n      listTools: jest.fn().mockResolvedValue([\n        {\n          name: \"mcp-tool\",\n          description: \"Tool from MCP\",\n          inputSchema: {},\n          outputSchema: {},\n          // MCP may include maxCalls in the tool metadata\n          maxCalls: 7,\n        },\n      ]),\n      close: jest.fn(),\n    });\n\n    // Render provider to trigger MCP sync\n    render(\n      <TestWrapper mcpServers={[\"https://mcp.example\"]}>\n        <div />\n      </TestWrapper>,\n    );\n\n    // Wait for registerTool to be called\n    await waitFor(() => {\n      expect(registerToolMock).toHaveBeenCalled();\n    });\n\n    // Inspect the first registered tool\n    const registered = registerToolMock.mock.calls[0][0];\n    expect(registered).toBeDefined();\n    expect(registered.name).toBe(\"mcp-tool\");\n    expect(registered.maxCalls).toBe(7);\n  });\n\n  it(\"reuses client when same server is passed with new array instance\", async () => {\n    const createSpy = jest.fn().mockResolvedValue({\n      listTools: jest.fn().mockResolvedValue([]),\n      close: jest.fn(),\n    });\n    (MCPClient as unknown as any).create = createSpy;\n\n    let latest: McpServer[] = [];\n    const initial = [{ url: \"https://a.example\", transport: MCPTransport.SSE }];\n\n    const { rerender } = render(\n      <TestWrapper mcpServers={initial}>\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Verify client was created once\n    expect(createSpy).toHaveBeenCalledTimes(1);\n    const firstClient = latest[0].client;\n\n    // Pass a new array with same server\n    const same = [{ url: \"https://a.example\", transport: MCPTransport.SSE }];\n    rerender(\n      <TestWrapper mcpServers={same}>\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Client should NOT have been created again\n    expect(createSpy).toHaveBeenCalledTimes(1);\n    // Should be the exact same client instance\n    expect(latest[0].client).toBe(firstClient);\n  });\n\n  it(\"calls close() on removed server clients\", async () => {\n    const closeSpy = jest.fn();\n    const createSpy = jest.fn().mockResolvedValue({\n      listTools: jest.fn().mockResolvedValue([]),\n      close: closeSpy,\n    });\n    (MCPClient as unknown as any).create = createSpy;\n\n    let latest: McpServer[] = [];\n    const { rerender } = render(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider\n          mcpServers={[\"https://a.example\", \"https://b.example\"]}\n        >\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n    });\n\n    expect(closeSpy).not.toHaveBeenCalled();\n\n    // Remove one server\n    rerender(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider mcpServers={[\"https://a.example\"]}>\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // close() should have been called once for the removed server\n    expect(closeSpy).toHaveBeenCalledTimes(1);\n  });\n\n  it(\"calls close() on all clients when provider unmounts\", async () => {\n    const closeSpy = jest.fn();\n    const createSpy = jest.fn().mockResolvedValue({\n      listTools: jest.fn().mockResolvedValue([]),\n      close: closeSpy,\n    });\n    (MCPClient as unknown as any).create = createSpy;\n\n    let latest: McpServer[] = [];\n    const { unmount } = render(\n      <TamboClientContext.Provider\n        value={{\n          client: useTamboClient(),\n          queryClient: {} as any,\n          isUpdatingToken: false,\n        }}\n      >\n        <TamboRegistryProvider\n          mcpServers={[\"https://a.example\", \"https://b.example\"]}\n        >\n          <TamboMcpTokenProvider>\n            <TamboMcpProvider>\n              <Capture onUpdate={(s) => (latest = s)} />\n            </TamboMcpProvider>\n          </TamboMcpTokenProvider>\n        </TamboRegistryProvider>\n      </TamboClientContext.Provider>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n    });\n\n    expect(closeSpy).not.toHaveBeenCalled();\n\n    // Unmount the provider\n    unmount();\n\n    // close() should have been called for both clients\n    expect(closeSpy).toHaveBeenCalledTimes(2);\n  });\n\n  it(\"creates new client when customHeaders change\", async () => {\n    const closeSpy = jest.fn();\n    let clientIdCounter = 0;\n    const createSpy = jest.fn().mockImplementation(async () => {\n      const id = ++clientIdCounter;\n      return {\n        id, // Add an ID so we can track which client is which\n        listTools: jest.fn().mockResolvedValue([]),\n        close: closeSpy,\n      };\n    });\n    (MCPClient as unknown as any).create = createSpy;\n\n    let latest: McpServer[] = [];\n    const { rerender } = render(\n      <TestWrapper\n        mcpServers={[\n          {\n            url: \"https://a.example\",\n            transport: MCPTransport.SSE,\n            customHeaders: { Authorization: \"Bearer token1\" },\n          },\n        ]}\n      >\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n      expect(createSpy).toHaveBeenCalledTimes(1);\n    });\n\n    const firstClientId = (latest[0].client as any)?.id;\n    expect(firstClientId).toBe(1);\n\n    // Change the customHeaders\n    rerender(\n      <TestWrapper\n        mcpServers={[\n          {\n            url: \"https://a.example\",\n            transport: MCPTransport.SSE,\n            customHeaders: { Authorization: \"Bearer token2\" },\n          },\n        ]}\n      >\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    // Wait for old client to be closed and new client to be created\n    await waitFor(\n      () => {\n        expect(closeSpy).toHaveBeenCalledTimes(1);\n        expect(createSpy).toHaveBeenCalledTimes(2);\n        expect(latest.length).toBe(1);\n        const newClientId = (latest[0].client as any)?.id;\n        expect(newClientId).toBe(2); // Should be the new client\n      },\n      { timeout: 3000 },\n    );\n  });\n\n  // Note: Token changes for the internal Tambo server are covered by the\n  // \"creates new client when customHeaders change\" test above, since token\n  // changes result in different Authorization headers, which trigger client recreation.\n});\n\ndescribe(\"TamboMcpProvider handler support\", () => {\n  let mockClient: any;\n  let createSpy: jest.Mock;\n\n  beforeEach(() => {\n    // Mock registry so tool registration is a no-op\n    (useTamboRegistry as unknown as jest.Mock).mockReturnValue({\n      registerTool: jest.fn(),\n    });\n\n    // Mock client with baseURL\n    (useTamboClient as unknown as jest.Mock).mockReturnValue({\n      baseURL: \"https://api.tambo.co\",\n    });\n\n    // Create a mock client with update methods\n    mockClient = {\n      listTools: jest.fn().mockResolvedValue([]),\n      updateElicitationHandler: jest.fn(),\n      updateSamplingHandler: jest.fn(),\n      close: jest.fn(),\n    };\n\n    // Mock MCPClient.create to return our mock client\n    createSpy = jest.fn().mockResolvedValue(mockClient);\n    (MCPClient as unknown as any).create = createSpy;\n  });\n\n  const Capture: React.FC<{ onUpdate: (servers: McpServer[]) => void }> = ({\n    onUpdate,\n  }) => {\n    const servers = useTamboMcpServers();\n    useEffect(() => {\n      onUpdate(servers);\n    }, [servers, onUpdate]);\n    return null;\n  };\n\n  it(\"should pass provider-level elicitation handler to MCPClient.create\", async () => {\n    const mockElicitationHandler = jest.fn().mockResolvedValue({\n      content: [{ type: \"text\", text: \"test\" }],\n    });\n\n    const handlers: ProviderMCPHandlers = {\n      elicitation: mockElicitationHandler,\n    };\n\n    let latest: McpServer[] = [];\n    render(\n      <TestWrapper mcpServers={[\"https://test.example\"]} handlers={handlers}>\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Verify MCPClient.create was called with an HTTP transport and wrapped handler\n    expect(createSpy).toHaveBeenCalledWith(\n      \"https://test.example\",\n      MCPTransport.HTTP,\n      undefined,\n      undefined,\n      undefined,\n      expect.objectContaining({\n        elicitation: expect.any(Function),\n      }),\n    );\n\n    // Get the actual handler that was passed\n    const passedHandlers = createSpy.mock.calls[0][5];\n    expect(passedHandlers.elicitation).toBeDefined();\n\n    // Call the wrapped handler and verify it receives serverInfo\n    const mockRequest = {\n      method: \"sampling/createMessage\" as const,\n      params: {},\n    };\n    const mockExtra = createMockExtra();\n    await passedHandlers.elicitation(mockRequest, mockExtra);\n\n    expect(mockElicitationHandler).toHaveBeenCalledWith(\n      mockRequest,\n      mockExtra,\n      expect.objectContaining({\n        url: \"https://test.example\",\n        serverKey: \"test\",\n      }),\n    );\n  });\n\n  it(\"should pass provider-level sampling handler to MCPClient.create\", async () => {\n    const mockSamplingHandler = jest.fn().mockResolvedValue({\n      model: \"test-model\",\n      stopReason: \"endTurn\",\n      role: \"assistant\",\n      content: { type: \"text\", text: \"response\" },\n    });\n\n    const handlers: ProviderMCPHandlers = {\n      sampling: mockSamplingHandler,\n    };\n\n    let latest: McpServer[] = [];\n    render(\n      <TestWrapper mcpServers={[\"https://test.example\"]} handlers={handlers}>\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Verify MCPClient.create was called with HTTP transport and sampling handler\n    expect(createSpy).toHaveBeenCalledWith(\n      \"https://test.example\",\n      MCPTransport.HTTP,\n      undefined,\n      undefined,\n      undefined,\n      expect.objectContaining({\n        sampling: expect.any(Function),\n      }),\n    );\n\n    // Get the actual handler and verify it receives serverInfo\n    const passedHandlers = createSpy.mock.calls[0][5];\n    const mockRequest = {\n      method: \"sampling/createMessage\" as const,\n      params: {\n        messages: [],\n        modelPreferences: {},\n      },\n    };\n    const mockExtra = createMockExtra();\n    await passedHandlers.sampling(mockRequest, mockExtra);\n\n    expect(mockSamplingHandler).toHaveBeenCalledWith(\n      mockRequest,\n      mockExtra,\n      expect.objectContaining({\n        url: \"https://test.example\",\n        serverKey: \"test\",\n      }),\n    );\n  });\n\n  it(\"should allow per-server handlers to override provider-level handlers\", async () => {\n    const providerElicitationHandler = jest.fn().mockResolvedValue({\n      content: [{ type: \"text\", text: \"provider\" }],\n    });\n\n    const serverElicitationHandler = jest.fn().mockResolvedValue({\n      content: [{ type: \"text\", text: \"server\" }],\n    });\n\n    const handlers: ProviderMCPHandlers = {\n      elicitation: providerElicitationHandler,\n    };\n\n    let latest: McpServer[] = [];\n    render(\n      <TestWrapper\n        mcpServers={[\n          {\n            url: \"https://test.example\",\n            handlers: {\n              elicitation: serverElicitationHandler,\n            },\n          },\n        ]}\n        handlers={handlers}\n      >\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Verify the per-server handler was used, not the provider handler\n    const passedHandlers = createSpy.mock.calls[0][5];\n    expect(passedHandlers.elicitation).toBe(serverElicitationHandler);\n  });\n\n  it(\"should pass different serverInfo to handlers for different servers\", async () => {\n    const mockElicitationHandler = jest.fn().mockResolvedValue({\n      content: [{ type: \"text\", text: \"test\" }],\n    });\n\n    const handlers: ProviderMCPHandlers = {\n      elicitation: mockElicitationHandler,\n    };\n\n    let latest: McpServer[] = [];\n    render(\n      <TestWrapper\n        mcpServers={[\n          { url: \"https://server-a.example\", name: \"Server A\" },\n          { url: \"https://server-b.example\", name: \"Server B\" },\n        ]}\n        handlers={handlers}\n      >\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(2);\n    });\n\n    // Verify both servers got handlers\n    expect(createSpy).toHaveBeenCalledTimes(2);\n\n    // Get handlers for both servers\n    const serverAHandlers = createSpy.mock.calls[0][5];\n    const serverBHandlers = createSpy.mock.calls[1][5];\n\n    const mockRequest = {\n      method: \"sampling/createMessage\" as const,\n      params: {},\n    };\n    const mockExtra = createMockExtra();\n\n    // Call handler for server A\n    await serverAHandlers.elicitation(mockRequest, mockExtra);\n    expect(mockElicitationHandler).toHaveBeenCalledWith(\n      mockRequest,\n      mockExtra,\n      expect.objectContaining({\n        url: \"https://server-a.example\",\n        name: \"Server A\",\n      }),\n    );\n\n    mockElicitationHandler.mockClear();\n\n    // Call handler for server B\n    await serverBHandlers.elicitation(mockRequest, mockExtra);\n    expect(mockElicitationHandler).toHaveBeenCalledWith(\n      mockRequest,\n      mockExtra,\n      expect.objectContaining({\n        url: \"https://server-b.example\",\n        name: \"Server B\",\n      }),\n    );\n  });\n\n  it(\"should update handlers when provider handlers change\", async () => {\n    const initialHandler = jest.fn().mockResolvedValue({\n      content: [{ type: \"text\", text: \"initial\" }],\n    });\n\n    const updatedHandler = jest.fn().mockResolvedValue({\n      content: [{ type: \"text\", text: \"updated\" }],\n    });\n\n    let latest: McpServer[] = [];\n    const { rerender } = render(\n      <TestWrapper\n        mcpServers={[\"https://test.example\"]}\n        handlers={{ elicitation: initialHandler }}\n      >\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(latest.length).toBe(1);\n    });\n\n    // Update the handlers\n    rerender(\n      <TestWrapper\n        mcpServers={[\"https://test.example\"]}\n        handlers={{ elicitation: updatedHandler }}\n      >\n        <Capture onUpdate={(s) => (latest = s)} />\n      </TestWrapper>,\n    );\n\n    await waitFor(() => {\n      expect(mockClient.updateElicitationHandler).toHaveBeenCalled();\n    });\n\n    // Verify the handler was updated\n    expect(mockClient.updateElicitationHandler).toHaveBeenCalledWith(\n      expect.any(Function),\n    );\n  });\n});\n\ndescribe(\"TamboMcpProvider serverKey derivation and tool prefixing\", () => {\n  let mockRegisterTool: jest.Mock;\n\n  beforeEach(() => {\n    mockRegisterTool = jest.fn();\n\n    (useTamboRegistry as unknown as jest.Mock).mockReturnValue({\n      registerTool: mockRegisterTool,\n    });\n\n    (useTamboClient as unknown as jest.Mock).mockReturnValue({\n      baseURL: \"https://api.tambo.co\",\n    });\n  });\n\n  const Capture: React.FC<{ onUpdate: (servers: McpServer[]) => void }> = ({\n    onUpdate,\n  }) => {\n    const servers = useTamboMcpServers();\n    useEffect(() => {\n      onUpdate(servers);\n    }, [servers, onUpdate]);\n    return null;\n  };\n\n  describe(\"serverKey derivation\", () => {\n    it(\"should derive serverKey from URL when not provided\", async () => {\n      (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n        listTools: jest.fn().mockResolvedValue([]),\n        close: jest.fn(),\n      });\n\n      let latest: McpServer[] = [];\n      render(\n        <TestWrapper mcpServers={[\"https://mcp.linear.app/mcp\"]}>\n          <Capture onUpdate={(s) => (latest = s)} />\n        </TestWrapper>,\n      );\n\n      await waitFor(() => {\n        expect(latest.length).toBe(1);\n        expect(latest[0].serverKey).toBe(\"linear\");\n      });\n    });\n\n    it(\"should use provided serverKey when specified\", async () => {\n      (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n        listTools: jest.fn().mockResolvedValue([]),\n        close: jest.fn(),\n      });\n\n      let latest: McpServer[] = [];\n      render(\n        <TestWrapper\n          mcpServers={[\n            {\n              url: \"https://mcp.linear.app/mcp\",\n              serverKey: \"custom-key\",\n            },\n          ]}\n        >\n          <Capture onUpdate={(s) => (latest = s)} />\n        </TestWrapper>,\n      );\n\n      await waitFor(() => {\n        expect(latest.length).toBe(1);\n        expect(latest[0].serverKey).toBe(\"custom-key\");\n      });\n    });\n\n    it(\"should derive serverKey correctly for various URL patterns\", async () => {\n      (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n        listTools: jest.fn().mockResolvedValue([]),\n        close: jest.fn(),\n      });\n\n      const testCases = [\n        { url: \"https://api.github.com\", expected: \"github\" },\n        { url: \"https://google.com\", expected: \"google\" },\n        { url: \"https://google.co.uk\", expected: \"google\" },\n        { url: \"https://mcp.company.co.uk\", expected: \"company\" },\n        { url: \"https://www.example.com\", expected: \"example\" },\n      ];\n\n      for (const { url, expected } of testCases) {\n        let latest: McpServer[] = [];\n        const { unmount } = render(\n          <TestWrapper mcpServers={[url]}>\n            <Capture onUpdate={(s) => (latest = s)} />\n          </TestWrapper>,\n        );\n\n        await waitFor(() => {\n          expect(latest.length).toBe(1);\n          expect(latest[0].serverKey).toBe(expected);\n        });\n\n        unmount();\n      }\n    });\n  });\n\n  describe(\"tool name prefixing\", () => {\n    it(\"should NOT prefix tool names when only one server is present\", async () => {\n      (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n        listTools: jest\n          .fn()\n          .mockResolvedValue([\n            { name: \"test-tool\", description: \"A test tool\" },\n          ]),\n        close: jest.fn(),\n      });\n\n      let latest: McpServer[] = [];\n      render(\n        <TestWrapper mcpServers={[\"https://mcp.linear.app/mcp\"]}>\n          <Capture onUpdate={(s) => (latest = s)} />\n        </TestWrapper>,\n      );\n\n      await waitFor(() => {\n        expect(latest.length).toBe(1);\n        expect(mockRegisterTool).toHaveBeenCalledWith(\n          expect.objectContaining({\n            name: \"test-tool\", // NOT prefixed\n          }),\n        );\n      });\n    });\n\n    it(\"should prefix tool names when multiple servers are present\", async () => {\n      (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n        listTools: jest\n          .fn()\n          .mockResolvedValue([\n            { name: \"test-tool\", description: \"A test tool\" },\n          ]),\n        close: jest.fn(),\n      });\n\n      let latest: McpServer[] = [];\n      render(\n        <TestWrapper\n          mcpServers={[\"https://mcp.linear.app/mcp\", \"https://api.github.com\"]}\n        >\n          <Capture onUpdate={(s) => (latest = s)} />\n        </TestWrapper>,\n      );\n\n      await waitFor(\n        () => {\n          expect(latest.length).toBe(2);\n          // Check that tools are registered with prefixed names\n          const calls = mockRegisterTool.mock.calls;\n          const toolNames = calls.map((call) => call[0].name);\n\n          // Debug: log the actual tool names registered\n          if (toolNames.length < 2) {\n            throw new Error(\n              `Only ${toolNames.length} tools registered: ${toolNames.join(\", \")}`,\n            );\n          }\n\n          expect(\n            calls.some((call) => call[0].name === \"linear__test-tool\"),\n          ).toBe(true);\n          expect(\n            calls.some((call) => call[0].name === \"github__test-tool\"),\n          ).toBe(true);\n        },\n        { timeout: 5000 },\n      );\n    });\n\n    it(\"should use custom serverKey in prefix when provided\", async () => {\n      (MCPClient as unknown as any).create = jest.fn().mockResolvedValue({\n        listTools: jest\n          .fn()\n          .mockResolvedValue([\n            { name: \"test-tool\", description: \"A test tool\" },\n          ]),\n        close: jest.fn(),\n      });\n\n      let latest: McpServer[] = [];\n      render(\n        <TestWrapper\n          mcpServers={[\n            {\n              url: \"https://mcp.linear.app/mcp\",\n              serverKey: \"my-server\",\n            },\n            \"https://api.github.com\",\n          ]}\n        >\n          <Capture onUpdate={(s) => (latest = s)} />\n        </TestWrapper>,\n      );\n\n      await waitFor(() => {\n        expect(latest.length).toBe(2);\n        const calls = mockRegisterTool.mock.calls;\n        expect(\n          calls.some((call) => call[0].name === \"my-server__test-tool\"),\n        ).toBe(true);\n      });\n    });\n  });\n});\n"]}
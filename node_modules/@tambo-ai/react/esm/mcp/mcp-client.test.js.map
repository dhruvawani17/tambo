{"version":3,"file":"mcp-client.test.js","sourceRoot":"","sources":["../../src/mcp/mcp-client.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { MCPClient, MCPTransport } from \"./mcp-client\";\n\n// Mock the MCP SDK modules\njest.mock(\"@modelcontextprotocol/sdk/client/index.js\", () => ({\n  Client: jest.fn().mockImplementation(() => ({\n    connect: jest.fn(),\n    close: jest.fn(),\n    listTools: jest.fn(),\n    callTool: jest.fn(),\n    setRequestHandler: jest.fn(),\n    removeRequestHandler: jest.fn(),\n  })),\n}));\n\njest.mock(\"@modelcontextprotocol/sdk/client/sse.js\", () => ({\n  SSEClientTransport: jest.fn().mockImplementation(() => ({\n    // SSE transport doesn't have sessionId\n  })),\n}));\n\njest.mock(\"@modelcontextprotocol/sdk/client/streamableHttp.js\", () => ({\n  StreamableHTTPClientTransport: jest\n    .fn()\n    .mockImplementation((url, options) => ({\n      sessionId: options?.sessionId,\n    })),\n}));\n\nimport { Client } from \"@modelcontextprotocol/sdk/client/index.js\";\nimport { SSEClientTransport } from \"@modelcontextprotocol/sdk/client/sse.js\";\nimport { StreamableHTTPClientTransport } from \"@modelcontextprotocol/sdk/client/streamableHttp.js\";\n\n// Type the mocked modules\nconst MockedClient = Client as jest.MockedClass<typeof Client>;\nconst MockedSSEClientTransport = SSEClientTransport as jest.MockedClass<\n  typeof SSEClientTransport\n>;\nconst MockedStreamableHTTPClientTransport =\n  StreamableHTTPClientTransport as jest.MockedClass<\n    typeof StreamableHTTPClientTransport\n  >;\n\ndescribe(\"MCPClient\", () => {\n  let mockClientInstance: any;\n  let mockTransportInstance: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    // Create mock instances\n    mockClientInstance = {\n      connect: jest.fn().mockResolvedValue(undefined),\n      close: jest.fn().mockResolvedValue(undefined),\n      listTools: jest.fn(),\n      callTool: jest.fn(),\n      setRequestHandler: jest.fn(),\n      removeRequestHandler: jest.fn(),\n    };\n\n    mockTransportInstance = {\n      sessionId: \"test-session-id\",\n    };\n\n    // Setup mocks\n    MockedClient.mockImplementation(() => mockClientInstance);\n    MockedStreamableHTTPClientTransport.mockImplementation(\n      () => mockTransportInstance,\n    );\n    MockedSSEClientTransport.mockImplementation(\n      () => ({}) as SSEClientTransport,\n    );\n  });\n\n  describe(\"create\", () => {\n    it(\"should create and connect an MCPClient with HTTP transport by default\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const headers = { Authorization: \"Bearer token\" };\n\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        headers,\n        undefined,\n        undefined,\n      );\n\n      expect(MockedStreamableHTTPClientTransport).toHaveBeenCalledWith(\n        new URL(endpoint),\n        { sessionId: undefined, requestInit: { headers } },\n      );\n      expect(MockedClient).toHaveBeenCalledWith(\n        {\n          name: \"tambo-mcp-client\",\n          version: \"1.0.0\",\n        },\n        { capabilities: {} },\n      );\n      expect(mockClientInstance.connect).toHaveBeenCalledWith(\n        mockTransportInstance,\n      );\n      expect(client).toBeInstanceOf(MCPClient);\n    });\n\n    it(\"should create and connect an MCPClient with SSE transport\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.SSE,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      expect(MockedSSEClientTransport).toHaveBeenCalledWith(new URL(endpoint), {\n        requestInit: { headers: {} },\n      });\n      expect(mockClientInstance.connect).toHaveBeenCalledWith({});\n      expect(client).toBeInstanceOf(MCPClient);\n    });\n\n    it(\"should create client with default headers when none provided\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n\n      await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      expect(MockedStreamableHTTPClientTransport).toHaveBeenCalledWith(\n        new URL(endpoint),\n        { sessionId: undefined, requestInit: { headers: {} } },\n      );\n    });\n  });\n\n  describe(\"listTools\", () => {\n    it(\"should list all tools with pagination\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      const mockTools = [\n        {\n          name: \"tool1\",\n          description: \"First tool\",\n          inputSchema: {\n            type: \"object\",\n            properties: { arg1: { type: \"string\" } },\n          },\n        },\n        {\n          name: \"tool2\",\n          description: \"Second tool\",\n          inputSchema: {\n            type: \"object\",\n            properties: { arg2: { type: \"number\" } },\n          },\n        },\n      ];\n\n      const mockResponse1 = {\n        tools: [mockTools[0]],\n        nextCursor: \"cursor1\",\n      };\n\n      const mockResponse2 = {\n        tools: [mockTools[1]],\n        nextCursor: undefined,\n      };\n\n      mockClientInstance.listTools\n        .mockResolvedValueOnce(mockResponse1)\n        .mockResolvedValueOnce(mockResponse2);\n\n      const result = await client.listTools();\n\n      expect(mockClientInstance.listTools).toHaveBeenCalledTimes(2);\n      expect(mockClientInstance.listTools).toHaveBeenNthCalledWith(\n        1,\n        { cursor: undefined },\n        {},\n      );\n      expect(mockClientInstance.listTools).toHaveBeenNthCalledWith(\n        2,\n        { cursor: \"cursor1\" },\n        {},\n      );\n      expect(result).toEqual([\n        {\n          name: \"tool1\",\n          description: \"First tool\",\n          inputSchema: {\n            type: \"object\",\n            properties: { arg1: { type: \"string\" } },\n          },\n        },\n        {\n          name: \"tool2\",\n          description: \"Second tool\",\n          inputSchema: {\n            type: \"object\",\n            properties: { arg2: { type: \"number\" } },\n          },\n        },\n      ]);\n    });\n\n    it(\"should handle single page of tools\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      const mockTools = [\n        {\n          name: \"tool1\",\n          description: \"Only tool\",\n          inputSchema: {\n            type: \"object\",\n            properties: { arg1: { type: \"string\" } },\n          },\n        },\n      ];\n\n      const mockResponse = {\n        tools: mockTools,\n        nextCursor: undefined,\n      };\n\n      mockClientInstance.listTools.mockResolvedValue(mockResponse);\n\n      const result = await client.listTools();\n\n      expect(mockClientInstance.listTools).toHaveBeenCalledTimes(1);\n      expect(result).toEqual([\n        {\n          name: \"tool1\",\n          description: \"Only tool\",\n          inputSchema: {\n            type: \"object\",\n            properties: { arg1: { type: \"string\" } },\n          },\n        },\n      ]);\n    });\n\n    it(\"should throw error for invalid input schema\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      const mockTools = [\n        {\n          name: \"invalid-tool\",\n          description: \"Tool with invalid schema\",\n          inputSchema: { type: \"string\" }, // Invalid - should be object\n        },\n      ];\n\n      const mockResponse = {\n        tools: mockTools,\n        nextCursor: undefined,\n      };\n\n      mockClientInstance.listTools.mockResolvedValue(mockResponse);\n\n      await expect(client.listTools()).rejects.toThrow(\n        \"Input schema for tool invalid-tool is not an object\",\n      );\n    });\n  });\n\n  describe(\"callTool\", () => {\n    it(\"should call a tool with arguments\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      const mockResult = { success: true, data: \"test result\" };\n      mockClientInstance.callTool.mockResolvedValue(mockResult);\n\n      const result = await client.callTool(\"testTool\", {\n        arg1: \"value1\",\n        arg2: 42,\n      });\n\n      expect(mockClientInstance.callTool).toHaveBeenCalledWith({\n        name: \"testTool\",\n        arguments: { arg1: \"value1\", arg2: 42 },\n      });\n      expect(result).toBe(mockResult);\n    });\n\n    it(\"should handle tool call errors\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n      const error = new Error(\"Tool call failed\");\n      mockClientInstance.callTool.mockRejectedValue(error);\n\n      await expect(client.callTool(\"testTool\", {})).rejects.toThrow(\n        \"Tool call failed\",\n      );\n    });\n  });\n\n  describe(\"transport initialization\", () => {\n    it(\"should initialize HTTP transport with session ID\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const headers = { Authorization: \"Bearer token\" };\n\n      await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        headers,\n        undefined,\n        undefined,\n      );\n\n      expect(MockedStreamableHTTPClientTransport).toHaveBeenCalledWith(\n        new URL(endpoint),\n        { sessionId: undefined, requestInit: { headers } },\n      );\n    });\n\n    it(\"should initialize SSE transport without session ID\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const headers = { Authorization: \"Bearer token\" };\n\n      await MCPClient.create(\n        endpoint,\n        MCPTransport.SSE,\n        headers,\n        undefined,\n        undefined,\n      );\n\n      expect(MockedSSEClientTransport).toHaveBeenCalledWith(new URL(endpoint), {\n        requestInit: { headers },\n      });\n    });\n  });\n\n  describe(\"client initialization\", () => {\n    it(\"should initialize client with correct name and version\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n\n      await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      expect(MockedClient).toHaveBeenCalledWith(\n        {\n          name: \"tambo-mcp-client\",\n          version: \"1.0.0\",\n        },\n        { capabilities: {} },\n      );\n    });\n  });\n\n  describe(\"handlers (elicitation/sampling)\", () => {\n    it(\"sets handlers on create when provided\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const elicitation = jest.fn(async () => ({}) as any);\n      const sampling = jest.fn(async () => ({}) as any);\n\n      await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n        { elicitation, sampling },\n      );\n\n      expect(MockedClient).toHaveBeenLastCalledWith(\n        {\n          name: \"tambo-mcp-client\",\n          version: \"1.0.0\",\n        },\n        {\n          capabilities: {\n            elicitation: {},\n            sampling: {},\n          },\n        },\n      );\n\n      // Request handlers should be set for both\n      expect(mockClientInstance.setRequestHandler).toHaveBeenCalled();\n      expect(\n        (mockClientInstance.setRequestHandler as jest.Mock).mock.calls.length,\n      ).toBeGreaterThanOrEqual(2);\n    });\n\n    it(\"removes elicitation handler when set to undefined\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n        {\n          elicitation: async () => ({}) as any,\n        },\n      );\n\n      const removeSpy = mockClientInstance.removeRequestHandler as jest.Mock;\n\n      // then remove\n      removeSpy.mockClear();\n      await client.updateElicitationHandler(undefined);\n      expect(removeSpy).toHaveBeenCalledWith(expect.any(String));\n    });\n\n    it(\"removes sampling handler when set to undefined\", async () => {\n      const endpoint = \"https://api.example.com/mcp\";\n      const client = await MCPClient.create(\n        endpoint,\n        MCPTransport.HTTP,\n        undefined,\n        undefined,\n        undefined,\n        {\n          sampling: async () => ({}) as any,\n        },\n      );\n\n      const removeSpy = mockClientInstance.removeRequestHandler as jest.Mock;\n\n      // then remove\n      removeSpy.mockClear();\n      await client.updateSamplingHandler(undefined);\n      expect(removeSpy).toHaveBeenCalledWith(expect.any(String));\n    });\n  });\n});\n"]}
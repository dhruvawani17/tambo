{"version":3,"file":"use-current-message.js","sourceRoot":"","sources":["../../src/hooks/use-current-message.tsx"],"names":[],"mappings":"AAAA,YAAY,CAAC;AACb,OAAO,KAAK,EAAE,EAAE,aAAa,EAAE,UAAU,EAAE,MAAM,OAAO,CAAC;AAMzD,MAAM,CAAC,MAAM,mBAAmB,GAAG,aAAa,CAC9C,IAAI,CACL,CAAC;AASF;;;;;;;;GAQG;AACH,MAAM,CAAC,MAAM,oBAAoB,GAAwC,CAAC,EACxE,QAAQ,EACR,OAAO,EACP,oBAAoB,GACrB,EAAE,EAAE;IACH,uDAAuD;IACvD,MAAM,eAAe,GAAuB,oBAAoB;QAC9D,CAAC,CAAC,EAAE,GAAG,OAAO,EAAE,oBAAoB,EAAE;QACtC,CAAC,CAAC,OAAO,CAAC;IAEZ,8EAA8E;IAC9E,2EAA2E;IAC3E,6EAA6E;IAC7E,OAAO,CACL,oBAAC,mBAAmB,CAAC,QAAQ,IAAC,KAAK,EAAE,eAAe,EAAE,GAAG,EAAE,OAAO,CAAC,EAAE,IAClE,QAAQ,CACoB,CAChC,CAAC;AACJ,CAAC,CAAC;AAEF;;;;;;;GAOG;AACH,MAAM,UAAU,4BAA4B,CAC1C,QAAyB,EACzB,OAA2B,EAC3B,oBAA2C;IAE3C,OAAO,CACL,oBAAC,oBAAoB,IACnB,OAAO,EAAE,OAAO,EAChB,oBAAoB,EAAE,oBAAoB,IAEzC,QAAQ,CACY,CACxB,CAAC;AACJ,CAAC;AAED;;;;GAIG;AACH,MAAM,CAAC,MAAM,sBAAsB,GAAG,GAAG,EAAE;IACzC,MAAM,OAAO,GAAG,UAAU,CAAC,mBAAmB,CAAC,CAAC;IAChD,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,MAAM,IAAI,KAAK,CACb,mEAAmE,CACpE,CAAC;IACJ,CAAC;IACD,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC;AAmBF;;;;;;;;;;;;;;;;;;;;;GAqBG;AACH,MAAM,CAAC,MAAM,wBAAwB,GAAG,GAAiC,EAAE;IACzE,MAAM,OAAO,GAAG,UAAU,CAAC,mBAAmB,CAAC,CAAC;IAEhD,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,OAAO,IAAI,CAAC;IACd,CAAC;IAED,OAAO;QACL,aAAa,EACX,OAAO,CAAC,oBAAoB,EAAE,aAAa;YAC3C,OAAO,CAAC,SAAS,EAAE,aAAa;YAChC,SAAS;QACX,KAAK,EAAE,OAAO,CAAC,SAAS,EAAE,KAAwC;QAClE,cAAc,EAAE,OAAO,CAAC,oBAAoB,EAAE,EAAE,IAAI,SAAS;QAC7D,WAAW,EAAE,OAAO,CAAC,oBAAoB,EAAE,WAAW,IAAI,SAAS;QACnE,QAAQ,EAAE,OAAO,CAAC,QAAQ;KAC3B,CAAC;AACJ,CAAC,CAAC","sourcesContent":["\"use client\";\nimport React, { createContext, useContext } from \"react\";\nimport {\n  InteractableMetadata,\n  TamboThreadMessage,\n} from \"../model/generate-component-response\";\n\nexport const TamboMessageContext = createContext<TamboThreadMessage | null>(\n  null,\n);\n\nexport interface TamboMessageProviderProps {\n  children: React.ReactNode;\n  message: TamboThreadMessage;\n  /** Optional interactable metadata for components wrapped with withInteractable */\n  interactableMetadata?: InteractableMetadata;\n}\n\n/**\n * Wraps all components, so that they can find what message they are in.\n * Also supports optional interactable metadata for components wrapped with withInteractable.\n * @param props - props for the TamboMessageProvider\n * @param props.children - The children to wrap\n * @param props.message - The message object\n * @param props.interactableMetadata - Optional interactable component metadata\n * @returns The wrapped component\n */\nexport const TamboMessageProvider: React.FC<TamboMessageProviderProps> = ({\n  children,\n  message,\n  interactableMetadata,\n}) => {\n  // Merge interactable metadata into message if provided\n  const enhancedMessage: TamboThreadMessage = interactableMetadata\n    ? { ...message, interactableMetadata }\n    : message;\n\n  // Use a unique key={...} to force a re-render when the message changes - this\n  // make sure that if the rendered component is swapped into a tree (like if\n  // you always show the last rendered component) then the state/etc is correct\n  return (\n    <TamboMessageContext.Provider value={enhancedMessage} key={message.id}>\n      {children}\n    </TamboMessageContext.Provider>\n  );\n};\n\n/**\n * Wraps a component with a TamboMessageProvider - this allows the provider\n * to be used outside of a TSX file\n * @param children - The children to wrap\n * @param message - The message object\n * @param interactableMetadata - Optional interactable metadata\n * @returns The wrapped component\n */\nexport function wrapWithTamboMessageProvider(\n  children: React.ReactNode,\n  message: TamboThreadMessage,\n  interactableMetadata?: InteractableMetadata,\n) {\n  return (\n    <TamboMessageProvider\n      message={message}\n      interactableMetadata={interactableMetadata}\n    >\n      {children}\n    </TamboMessageProvider>\n  );\n}\n\n/**\n * Hook used inside a component wrapped with TamboMessageProvider, to get\n * the current message.\n * @returns The current message that is used to render the component\n */\nexport const useTamboCurrentMessage = () => {\n  const message = useContext(TamboMessageContext);\n  if (!message) {\n    throw new Error(\n      \"useTamboCurrentMessage must be used within a TamboMessageProvider\",\n    );\n  }\n  return message;\n};\n\n/**\n * Component info extracted from the current message and interactable context.\n * Provides a unified interface for accessing component metadata.\n */\nexport interface TamboCurrentComponent {\n  /** Component name from the message */\n  componentName?: string;\n  /** Component props from the message */\n  props?: Record<string, any>;\n  /** Interactable ID (only present for components wrapped with withInteractable) */\n  interactableId?: string;\n  /** Description (only present for components wrapped with withInteractable) */\n  description?: string;\n  /** Thread ID from the message (only present when the component is part of a thread) */\n  threadId?: string;\n}\n\n/**\n * Hook to access the current component information from the message context.\n * Provides a unified interface for both AI-generated and interactable components.\n *\n * **Use this hook when you need component metadata regardless of the context.**\n * @returns Component info including name, props, and interactable metadata if available, or null if used outside TamboMessageProvider\n * @example\n * ```tsx\n * function MyInlineEditor() {\n *   const component = useTamboCurrentComponent();\n *\n *   if (!component) return null; // Not inside a component\n *\n *   return (\n *     <div>\n *       Editing: {component.componentName}\n *       {component.interactableId && <span>ID: {component.interactableId}</span>}\n *     </div>\n *   );\n * }\n * ```\n */\nexport const useTamboCurrentComponent = (): TamboCurrentComponent | null => {\n  const message = useContext(TamboMessageContext);\n\n  if (!message) {\n    return null;\n  }\n\n  return {\n    componentName:\n      message.interactableMetadata?.componentName ??\n      message.component?.componentName ??\n      undefined,\n    props: message.component?.props as Record<string, any> | undefined,\n    interactableId: message.interactableMetadata?.id ?? undefined,\n    description: message.interactableMetadata?.description ?? undefined,\n    threadId: message.threadId,\n  };\n};\n"]}
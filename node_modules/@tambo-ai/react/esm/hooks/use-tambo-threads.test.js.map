{"version":3,"file":"use-tambo-threads.test.js","sourceRoot":"","sources":["../../src/hooks/use-tambo-threads.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import TamboAI from \"@tambo-ai/typescript-sdk\";\nimport { QueryClient } from \"@tanstack/react-query\";\nimport { renderHook, waitFor } from \"@testing-library/react\";\nimport { useTamboThread } from \"../providers\";\nimport {\n  useTamboClient,\n  useTamboQueryClient,\n} from \"../providers/tambo-client-provider\";\nimport { PartialTamboAI } from \"../testing/types\";\nimport { useTamboThreadList } from \"./use-tambo-threads\";\n\njest.mock(\"../providers/tambo-client-provider\", () => ({\n  useTamboClient: jest.fn(),\n  useTamboQueryClient: jest.fn(),\n}));\n\njest.mock(\"../providers\", () => ({\n  useTamboThread: jest.fn(),\n}));\n\ndescribe(\"useTamboThreadList\", () => {\n  const mockThreads = [\n    { id: \"thread-1\", title: \"Thread 1\" },\n    { id: \"thread-2\", title: \"Thread 2\" },\n  ];\n\n  const mockProjects = {\n    getCurrent: jest.fn(),\n    retrieve: jest.fn(),\n    delete: jest.fn(),\n  } satisfies Partial<TamboAI[\"beta\"][\"projects\"]>;\n\n  const mockThreadsApi = {\n    list: jest.fn(),\n    messages: {\n      list: jest.fn(),\n      create: jest.fn(),\n      delete: jest.fn(),\n      updateComponentState: jest.fn(),\n    },\n    suggestions: {\n      list: jest.fn(),\n      generate: jest.fn(),\n    },\n    create: jest.fn(),\n    retrieve: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    advance: jest.fn(),\n    advanceByID: jest.fn(),\n  } satisfies NonNullable<PartialTamboAI[\"beta\"]>[\"threads\"];\n\n  const mockBeta = {\n    projects: mockProjects,\n    threads: mockThreadsApi,\n    registry: {\n      retrieve: jest.fn(),\n    },\n  } satisfies PartialTamboAI[\"beta\"];\n\n  const mockTamboAI = {\n    apiKey: \"\",\n    beta: mockBeta,\n  } satisfies PartialTamboAI as unknown as TamboAI;\n\n  beforeEach(() => {\n    jest.mocked(useTamboQueryClient).mockReturnValue(new QueryClient());\n    jest\n      .mocked(useTamboThread)\n      .mockReturnValue({ contextKey: undefined } as any);\n  });\n\n  it(\"should fetch threads for current project when no projectId is provided\", async () => {\n    const mockClient = jest.mocked(useTamboClient);\n    mockClient.mockReturnValue({\n      ...mockTamboAI,\n      beta: {\n        ...mockBeta,\n        projects: {\n          ...mockProjects,\n          getCurrent: jest.fn().mockResolvedValue({ id: \"current-project\" }),\n        },\n        threads: {\n          ...mockThreadsApi,\n          list: jest.fn().mockResolvedValue(mockThreads),\n        },\n      },\n    } satisfies PartialTamboAI as any);\n\n    const { result } = renderHook(() => useTamboThreadList());\n\n    await waitFor(() => {\n      expect(result.current.data).toEqual(mockThreads);\n    });\n  });\n\n  it(\"should fetch threads for specified projectId\", async () => {\n    const mockList = jest.fn().mockResolvedValue(mockThreads);\n    const mockClient = jest.mocked(useTamboClient);\n    mockClient.mockReturnValue({\n      ...mockTamboAI,\n      beta: {\n        ...mockBeta,\n        threads: {\n          ...mockThreadsApi,\n          list: mockList,\n        },\n      },\n    } satisfies PartialTamboAI as any);\n\n    const { result } = renderHook(() =>\n      useTamboThreadList({ projectId: \"custom-project\" }),\n    );\n\n    await waitFor(() => {\n      expect(result.current.data).toEqual(mockThreads);\n    });\n\n    expect(mockList).toHaveBeenCalledWith(\"custom-project\", {});\n  });\n\n  it(\"should fetch threads with contextKey when provided via TamboThreadProvider\", async () => {\n    jest\n      .mocked(useTamboThread)\n      .mockReturnValue({ contextKey: \"test-context\" } as any);\n    const mockList = jest.fn().mockResolvedValue(mockThreads);\n    const mockClient = jest.mocked(useTamboClient);\n    mockClient.mockReturnValue({\n      ...mockTamboAI,\n      beta: {\n        ...mockBeta,\n        projects: {\n          ...mockProjects,\n          getCurrent: jest.fn().mockResolvedValue({ id: \"current-project\" }),\n        },\n        threads: {\n          ...mockThreadsApi,\n          list: mockList,\n        },\n      },\n    } satisfies PartialTamboAI as any);\n\n    const { result } = renderHook(() => useTamboThreadList());\n\n    await waitFor(() => {\n      expect(result.current.data).toEqual(mockThreads);\n    });\n\n    expect(mockList).toHaveBeenCalledWith(\"current-project\", {\n      contextKey: \"test-context\",\n    });\n  });\n\n  it(\"should handle loading state\", async () => {\n    let resolvePromise: (value: any) => void;\n    const promise = new Promise((resolve) => {\n      resolvePromise = resolve;\n    });\n\n    const mockClient = jest.mocked(useTamboClient);\n    mockClient.mockReturnValue({\n      ...mockTamboAI,\n      beta: {\n        ...mockBeta,\n        projects: {\n          ...mockProjects,\n          getCurrent: jest.fn().mockResolvedValue({ id: \"current-project\" }),\n        },\n        threads: {\n          ...mockThreadsApi,\n          list: jest.fn().mockReturnValue(promise),\n        },\n      },\n    } satisfies PartialTamboAI as any);\n\n    const { result } = renderHook(() =>\n      useTamboThreadList({}, { retry: false }),\n    );\n\n    expect(result.current).toMatchInlineSnapshot(`\n      {\n        \"data\": null,\n        \"dataUpdatedAt\": 0,\n        \"error\": null,\n        \"errorUpdateCount\": 0,\n        \"errorUpdatedAt\": 0,\n        \"failureCount\": 0,\n        \"failureReason\": null,\n        \"fetchStatus\": \"fetching\",\n        \"isEnabled\": true,\n        \"isError\": false,\n        \"isFetched\": false,\n        \"isFetchedAfterMount\": false,\n        \"isFetching\": true,\n        \"isInitialLoading\": true,\n        \"isLoading\": true,\n        \"isLoadingError\": false,\n        \"isPaused\": false,\n        \"isPending\": true,\n        \"isPlaceholderData\": false,\n        \"isRefetchError\": false,\n        \"isRefetching\": false,\n        \"isStale\": true,\n        \"isSuccess\": false,\n        \"promise\": Promise {},\n        \"refetch\": [Function],\n        \"status\": \"pending\",\n      }\n    `);\n\n    resolvePromise!(mockThreads);\n    await waitFor(() => {\n      expect(result.current.isLoading).toBe(false);\n    });\n  });\n\n  it(\"should handle error state\", async () => {\n    const mockError = new Error(\"Failed to fetch threads\");\n    const mockClient = jest.mocked(useTamboClient);\n    mockClient.mockReturnValue({\n      ...mockTamboAI,\n      beta: {\n        ...mockBeta,\n        projects: {\n          ...mockProjects,\n          getCurrent: jest.fn().mockResolvedValue({ id: \"current-project\" }),\n        },\n        threads: {\n          ...mockThreadsApi,\n          list: jest.fn().mockImplementation(async () => {\n            // console.log(\"Mocking error\", mockCount++);\n            throw mockError;\n          }),\n        },\n      },\n    } satisfies PartialTamboAI as any);\n\n    const { result } = renderHook(() =>\n      useTamboThreadList({}, { retry: false }),\n    );\n\n    await waitFor(() => {\n      const { isLoading, error, isError } = result.current;\n      expect(isLoading).toBe(false);\n      expect(isError).toBe(true);\n      expect(error).toBe(mockError);\n    });\n  });\n});\n"]}
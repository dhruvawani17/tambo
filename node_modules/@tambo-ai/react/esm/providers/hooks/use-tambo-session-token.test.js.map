{"version":3,"file":"use-tambo-session-token.test.js","sourceRoot":"","sources":["../../../src/providers/hooks/use-tambo-session-token.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import TamboAI from \"@tambo-ai/typescript-sdk\";\nimport { QueryClient } from \"@tanstack/react-query\";\nimport { act, renderHook } from \"@testing-library/react\";\nimport { useTamboSessionToken } from \"./use-tambo-session-token\";\nimport type { PartialTamboAI } from \"../../testing/types\";\n\ndescribe(\"useTamboSessionToken\", () => {\n  const mockTokenResponse = {\n    access_token: \"test-access-token\",\n    expires_in: 3600, // 1 hour\n    token_type: \"Bearer\",\n  };\n\n  const mockAuthApi = {\n    getToken: jest.fn(),\n  } satisfies NonNullable<PartialTamboAI[\"beta\"]>[\"auth\"];\n\n  const mockBeta = {\n    auth: mockAuthApi,\n  } satisfies PartialTamboAI[\"beta\"];\n\n  const mockTamboAI = {\n    apiKey: \"\",\n    beta: mockBeta,\n    bearer: \"\",\n  } satisfies PartialTamboAI as unknown as TamboAI;\n  const queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n        refetchOnWindowFocus: false,\n      },\n    },\n  });\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    jest.clearAllTimers();\n    jest.useFakeTimers();\n    (mockTamboAI as any).bearer = \"\";\n    queryClient.clear();\n  });\n\n  afterEach(async () => {\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n    jest.useRealTimers();\n    jest.resetAllMocks();\n  });\n\n  it(\"should return null initially when no userToken is provided\", () => {\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, undefined),\n    );\n\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: false,\n    });\n    expect(mockAuthApi.getToken).not.toHaveBeenCalled();\n  });\n\n  it(\"should fetch and return session token when userToken is provided\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(1);\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: mockTokenResponse,\n      isFetching: false,\n    });\n    expect(mockTamboAI.bearer).toBe(mockTokenResponse.access_token);\n    // Verify the hook was called with correct parameters\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(2);\n    expect(mockAuthApi.getToken).toHaveBeenCalledWith(expect.any(Object));\n  });\n\n  it(\"should call getToken with correct token exchange parameters\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    const callArgs = mockAuthApi.getToken.mock.calls[0][0];\n    const tokenRequestString = new TextDecoder().decode(callArgs);\n    const tokenRequest = new URLSearchParams(tokenRequestString);\n\n    expect(tokenRequest.get(\"grant_type\")).toBe(\n      \"urn:ietf:params:oauth:grant-type:token-exchange\",\n    );\n    expect(tokenRequest.get(\"subject_token\")).toBe(\"user-token\");\n    expect(tokenRequest.get(\"subject_token_type\")).toBe(\n      \"urn:ietf:params:oauth:token-type:access_token\",\n    );\n  });\n\n  it(\"should set bearer token on client\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: mockTokenResponse,\n    });\n    expect(mockTamboAI.bearer).toBe(\"test-access-token\");\n  });\n\n  it(\"should handle different token responses\", async () => {\n    const customTokenResponse = {\n      access_token: \"custom-access-token\",\n      expires_in: 7200, // 2 hours\n      token_type: \"Bearer\",\n    };\n\n    mockAuthApi.getToken.mockResolvedValue(customTokenResponse);\n\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: true,\n    });\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: customTokenResponse,\n      isFetching: false,\n    });\n    expect(mockTamboAI.bearer).toBe(\"custom-access-token\");\n  });\n\n  it(\"should not fetch token when userToken changes to undefined\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    const { result, rerender } = renderHook(\n      ({ userToken }) =>\n        useTamboSessionToken(mockTamboAI, queryClient, userToken),\n      {\n        initialProps: { userToken: \"user-token\" as string | undefined },\n      },\n    );\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(1);\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: mockTokenResponse,\n      isFetching: false,\n    });\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(2);\n\n    // Clear mock and change userToken to undefined\n    jest.clearAllMocks();\n\n    act(() => {\n      rerender({ userToken: undefined });\n    });\n\n    expect(mockAuthApi.getToken).not.toHaveBeenCalled();\n  });\n\n  it(\"should refetch token when userToken changes\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    const { result, rerender } = renderHook(\n      ({ userToken }) =>\n        useTamboSessionToken(mockTamboAI, queryClient, userToken),\n      {\n        initialProps: { userToken: \"user-token-1\" },\n      },\n    );\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(1);\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: mockTokenResponse,\n      isFetching: false,\n    });\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(2);\n\n    // Mock response for new token\n    mockAuthApi.getToken.mockResolvedValue({\n      ...mockTokenResponse,\n      access_token: \"new-access-token\",\n    });\n\n    // Change userToken\n    act(() => {\n      rerender({ userToken: \"user-token-2\" });\n    });\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: { access_token: \"new-access-token\" },\n      isFetching: false,\n    });\n    expect(mockAuthApi.getToken).toHaveBeenCalledTimes(4);\n  });\n\n  it(\"should reset token when userToken becomes null\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    const { result, rerender } = renderHook(\n      ({ userToken }) =>\n        useTamboSessionToken(mockTamboAI, queryClient, userToken),\n      {\n        initialProps: { userToken: \"user-token\" as string | undefined },\n      },\n    );\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    expect(result.current).toMatchObject({\n      data: mockTokenResponse,\n      isFetching: false,\n    });\n\n    // Change userToken to undefined\n    rerender({ userToken: undefined });\n    await act(async () => {\n      await jest.runAllTimersAsync();\n    });\n\n    // Token should reset to null (hook doesn't reset it to null when userToken is undefined)\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: false,\n    });\n  });\n\n  it(\"should not update state if component is unmounted during token fetch\", async () => {\n    let resolvePromise: (value: any) => void;\n    const promise = new Promise((resolve) => {\n      resolvePromise = resolve;\n    });\n\n    mockAuthApi.getToken.mockReturnValue(promise);\n\n    const { result, unmount } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: true,\n    });\n\n    // Unmount before the promise resolves\n    unmount();\n\n    // Now resolve the promise\n    act(() => {\n      resolvePromise!(mockTokenResponse);\n    });\n\n    // Token should still be null since component was unmounted\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: true,\n    });\n  });\n\n  it(\"should set isUpdating to true while fetching token\", () => {\n    mockAuthApi.getToken.mockImplementation(async () => {\n      return await new Promise(() => {}); // Never resolves\n    });\n\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n\n    // Should be updating immediately when userToken is provided\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: true,\n    });\n  });\n\n  it(\"should set isUpdating to false after token fetch completes\", async () => {\n    mockAuthApi.getToken.mockResolvedValue(mockTokenResponse);\n\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n\n    // Should be updating initially\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: true,\n    });\n\n    await act(async () => {\n      await jest.runOnlyPendingTimersAsync();\n    });\n\n    // Should not be updating after completion\n    expect(result.current).toMatchObject({\n      data: mockTokenResponse,\n      isFetching: false,\n    });\n  });\n\n  it(\"should set isUpdating to false after token fetch fails\", async () => {\n    mockAuthApi.getToken.mockRejectedValue(new Error(\"Token fetch failed\"));\n\n    const { result } = renderHook(() =>\n      useTamboSessionToken(mockTamboAI, queryClient, \"user-token\"),\n    );\n\n    // Should be updating initially\n    expect(result.current).toMatchObject({\n      data: undefined,\n      isFetching: true,\n    });\n\n    await act(async () => {\n      await jest.runAllTimersAsync();\n    });\n\n    // Should not be updating after failure\n    expect(result.current).toMatchObject({\n      data: undefined,\n      error: expect.any(Error),\n      isFetching: false,\n    });\n  });\n});\n"]}
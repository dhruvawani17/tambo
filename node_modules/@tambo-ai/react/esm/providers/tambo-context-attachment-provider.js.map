{"version":3,"file":"tambo-context-attachment-provider.js","sourceRoot":"","sources":["../../src/providers/tambo-context-attachment-provider.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\";\n\nimport React, {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { useTamboContextHelpers } from \"./tambo-context-helpers-provider\";\n\n/**\n * Represents a context attachment that will be sent with the next user message.\n * These are automatically registered as context helpers and will be included in\n * the additionalContext when the next message is sent.\n * @property {string} id - Unique identifier for this context attachment\n * @property {string} [displayName] - Optional display name for UI rendering\n * @property {string} context - The context value that will be used in additionalContext\n * @property {string} [type] - Optional type identifier for grouping/rendering multiple contexts of the same type\n */\nexport interface ContextAttachment {\n  id: string;\n  displayName?: string;\n  context: string;\n  type?: string;\n}\n\n/**\n * Context state interface for managing context attachments.\n * @property {ContextAttachment[]} attachments - Array of active context attachments\n * @property {(contextAttachment: Omit<ContextAttachment, \"id\">) => ContextAttachment} addContextAttachment - Add a new context attachment, returns the attachment\n * @property {(id: string) => void} removeContextAttachment - Remove a context attachment by ID\n * @property {() => void} clearContextAttachments - Remove all context attachments\n */\nexport interface ContextAttachmentState {\n  attachments: ContextAttachment[];\n  addContextAttachment: (\n    contextAttachment: Omit<ContextAttachment, \"id\">,\n  ) => ContextAttachment;\n  removeContextAttachment: (id: string) => void;\n  clearContextAttachments: () => void;\n}\n\nconst ContextAttachmentContext = createContext<ContextAttachmentState | null>(\n  null,\n);\n\nexport interface TamboContextAttachmentProviderProps {\n  children?: React.ReactNode;\n}\n\nconst CONTEXT_ATTACHMENTS_HELPER_KEY = \"contextAttachments\";\n\n/**\n * Provider that manages context attachments for the next user message.\n * - **Included by default** in TamboProvider - no need to wrap separately\n * - Use `useTamboContextAttachment()` hook to manage context attachments\n * **What it does:**\n * - Stores context attachments that will be sent with the next message\n * - Automatically registers/deregisters context helpers for each attachment\n * - Context helpers are automatically collected during message submission\n * - Context attachments are cleared after message submission (one-time use)\n *\n * **Note:** Context attachments are automatically included in additionalContext when\n * the next message is sent. They are cleared after submission.\n * @param props - The props for the TamboContextAttachmentProvider\n * @param props.children - The children to wrap\n * @returns The TamboContextAttachmentProvider component\n */\nexport function TamboContextAttachmentProvider({\n  children,\n}: TamboContextAttachmentProviderProps) {\n  const { addContextHelper, removeContextHelper } = useTamboContextHelpers();\n  const [attachments, setAttachments] = useState<ContextAttachment[]>([]);\n\n  useEffect(() => {\n    addContextHelper(CONTEXT_ATTACHMENTS_HELPER_KEY, () => {\n      if (attachments.length === 0) {\n        return null;\n      }\n\n      return attachments.map((attachment) => ({\n        id: attachment.id,\n        displayName: attachment.displayName,\n        context: attachment.context,\n        type: attachment.type,\n      }));\n    });\n\n    return () => {\n      removeContextHelper(CONTEXT_ATTACHMENTS_HELPER_KEY);\n    };\n  }, [attachments, addContextHelper, removeContextHelper]);\n\n  /**\n   * Adds a new context attachment that will be included with the next user message.\n   * The attachment is automatically registered as part of the merged context helper.\n   * @param contextAttachment - The context attachment input (context, optional displayName, optional type)\n   * @returns The created ContextAttachment object with a unique ID\n   * @example\n   * ```tsx\n   * const attachment = addContextAttachment({\n   *   context: \"The contents of File.txt\",\n   *   displayName: \"File.txt\",\n   *   type: \"file\"\n   * });\n   * ```\n   */\n  const addContextAttachment = useCallback(\n    (contextAttachment: Omit<ContextAttachment, \"id\">): ContextAttachment => {\n      const id = crypto.randomUUID();\n      const attachment: ContextAttachment = {\n        id,\n        displayName: contextAttachment.displayName,\n        context: contextAttachment.context,\n        type: contextAttachment.type,\n      };\n      setAttachments((prev) => [...prev, attachment]);\n\n      return attachment;\n    },\n    [],\n  );\n\n  /**\n   * Removes a context attachment by its ID.\n   */\n  const removeContextAttachment = useCallback((id: string) => {\n    setAttachments((prev) => prev.filter((c) => c.id !== id));\n  }, []);\n\n  /**\n   * Removes all context attachments at once.\n   */\n  const clearContextAttachments = useCallback(() => {\n    setAttachments([]);\n  }, []);\n\n  const value = useMemo(\n    () => ({\n      attachments,\n      addContextAttachment,\n      removeContextAttachment,\n      clearContextAttachments,\n    }),\n    [\n      attachments,\n      addContextAttachment,\n      removeContextAttachment,\n      clearContextAttachments,\n    ],\n  );\n\n  return (\n    <ContextAttachmentContext.Provider value={value}>\n      {children}\n    </ContextAttachmentContext.Provider>\n  );\n}\n\n/**\n * Hook to access context attachment state and methods.\n * **Must be used within a `TamboProvider`** - throws an error otherwise.\n * @throws {Error} If used outside of TamboProvider\n * @returns The context attachment state and methods\n * @example\n * ```tsx\n * const { addContextAttachment, attachments, clearContextAttachments } = useTamboContextAttachment();\n *\n * // Add a context attachment for the next message\n * const attachment = addContextAttachment({\n *   context: \"The contents of File.txt\",\n *   displayName: \"File.txt\", // optional\n *   type: \"file\" // optional\n * });\n *\n * // Remove a context attachment\n * removeContextAttachment(attachment.id);\n *\n * // Clear all context attachments\n * clearContextAttachments();\n * ```\n */\nexport function useTamboContextAttachment() {\n  const context = useContext(ContextAttachmentContext);\n  if (!context) {\n    throw new Error(\n      \"useTamboContextAttachment must be used within a TamboContextAttachmentProvider\",\n    );\n  }\n  return context;\n}\n"]}
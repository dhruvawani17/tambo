"use strict";
"use client";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.useTambo = exports.TamboCompositeProvider = exports.TamboContext = exports.TamboProvider = void 0;
const react_1 = __importStar(require("react"));
const tambo_mcp_provider_1 = require("../mcp/tambo-mcp-provider");
const tambo_client_provider_1 = require("./tambo-client-provider");
const tambo_component_provider_1 = require("./tambo-component-provider");
const tambo_context_attachment_provider_1 = require("./tambo-context-attachment-provider");
const tambo_context_helpers_provider_1 = require("./tambo-context-helpers-provider");
const tambo_interactable_provider_1 = require("./tambo-interactable-provider");
const tambo_mcp_token_provider_1 = require("./tambo-mcp-token-provider");
const tambo_registry_provider_1 = require("./tambo-registry-provider");
const tambo_thread_input_provider_1 = require("./tambo-thread-input-provider");
const tambo_thread_provider_1 = require("./tambo-thread-provider");
/**
 * The TamboProvider gives full access to the whole Tambo API. This includes the
 * TamboAI client, the component registry, the current thread context, and interactable components.
 * @param props - The props for the TamboProvider
 * @param props.children - The children to wrap
 * @param props.tamboUrl - The URL of the Tambo API
 * @param props.apiKey - The API key for the Tambo API
 * @param props.components - The components to register
 * @param props.environment - The environment to use for the Tambo API
 * @param props.tools - The tools to register
 * @param props.mcpServers - The MCP servers to register (metadata only - use TamboMcpProvider for connections)
 * @param props.streaming - Whether to stream the response by default. Defaults to true.
 * @param props.autoGenerateThreadName - Whether to automatically generate thread names. Defaults to true.
 * @param props.autoGenerateNameThreshold - The message count threshold at which the thread name will be auto-generated. Defaults to 3.
 * @param props.contextHelpers - Configuration for which context helpers are enabled/disabled
 * @param props.userToken - The user's OAuth token (access or ID) used to identify the user and exchange for a Tambo session token
 * @param props.contextKey - Optional context key passed to thread input provider for scoping threads
 * @param props.onCallUnregisteredTool - Callback function called when an unregistered tool is called
 * @param props.initialMessages - Initial messages to be included in new threads
 * @param props.getResource - Optional getResource function for registry resources
 * @param props.listResources - Optional listResources function for registry resources
 * @param props.resources - Optional static resources for the registry
 * @returns The TamboProvider component
 */
const TamboProvider = ({ children, tamboUrl, apiKey, userToken, components, environment, tools, mcpServers, streaming, autoGenerateThreadName, autoGenerateNameThreshold, contextHelpers, contextKey, initialMessages, onCallUnregisteredTool, getResource, listResources, resources, }) => {
    return (react_1.default.createElement(tambo_client_provider_1.TamboClientProvider, { tamboUrl: tamboUrl, apiKey: apiKey, environment: environment, userToken: userToken },
        react_1.default.createElement(tambo_registry_provider_1.TamboRegistryProvider, { components: components, tools: tools, mcpServers: mcpServers, onCallUnregisteredTool: onCallUnregisteredTool, getResource: getResource, listResources: listResources, resources: resources },
            react_1.default.createElement(tambo_context_helpers_provider_1.TamboContextHelpersProvider, { contextHelpers: contextHelpers },
                react_1.default.createElement(tambo_thread_provider_1.TamboThreadProvider, { contextKey: contextKey, streaming: streaming, autoGenerateThreadName: autoGenerateThreadName, autoGenerateNameThreshold: autoGenerateNameThreshold, initialMessages: initialMessages },
                    react_1.default.createElement(tambo_mcp_token_provider_1.TamboMcpTokenProvider, null,
                        react_1.default.createElement(tambo_mcp_provider_1.TamboMcpProvider, { contextKey: contextKey },
                            react_1.default.createElement(tambo_context_attachment_provider_1.TamboContextAttachmentProvider, null,
                                react_1.default.createElement(tambo_component_provider_1.TamboComponentProvider, null,
                                    react_1.default.createElement(tambo_interactable_provider_1.TamboInteractableProvider, null,
                                        react_1.default.createElement(tambo_thread_input_provider_1.TamboThreadInputProvider, null,
                                            react_1.default.createElement(exports.TamboCompositeProvider, null, children))))))))))));
};
exports.TamboProvider = TamboProvider;
exports.TamboContext = (0, react_1.createContext)({});
/**
 * TamboCompositeProvider is a provider that combines the TamboClient,
 * TamboThread, TamboComponent, and TamboInteractable providers
 * @param props - The props for the TamboCompositeProvider
 * @param props.children - The children to wrap
 * @returns The wrapped component
 */
const TamboCompositeProvider = ({ children, }) => {
    const threads = (0, tambo_thread_provider_1.useTamboThread)();
    const clientContext = (0, react_1.useContext)(tambo_client_provider_1.TamboClientContext);
    if (!clientContext) {
        throw new Error("TamboCompositeProvider must be used within a TamboClientProvider");
    }
    const { client, queryClient, isUpdatingToken } = clientContext;
    const componentRegistry = (0, tambo_component_provider_1.useTamboComponent)();
    const interactableComponents = (0, tambo_interactable_provider_1.useTamboInteractable)();
    const contextHelpers = (0, tambo_context_helpers_provider_1.useTamboContextHelpers)();
    const contextAttachment = (0, tambo_context_attachment_provider_1.useTamboContextAttachment)();
    return (react_1.default.createElement(exports.TamboContext.Provider, { value: {
            client,
            queryClient,
            isUpdatingToken,
            ...componentRegistry,
            ...threads,
            ...interactableComponents,
            ...contextHelpers,
            ...contextAttachment,
        } }, children));
};
exports.TamboCompositeProvider = TamboCompositeProvider;
/**
 * The useTambo hook provides access to the Tambo API. This is the primary entrypoint
 * for the Tambo React SDK.
 *
 * This includes the TamboAI client, the component registry, the current thread context,
 * and interactable component management.
 * @returns The Tambo API
 */
const useTambo = () => {
    return (0, react_1.useContext)(exports.TamboContext);
};
exports.useTambo = useTambo;
//# sourceMappingURL=tambo-provider.js.map
{"version":3,"file":"use-tambo-session-token.js","sourceRoot":"","sources":["../../../src/providers/hooks/use-tambo-session-token.tsx"],"names":[],"mappings":";AAAA,YAAY,CAAC;;AAkBb,oDAsCC;AAtDD,uDAA8D;AAC9D,iCAAkC;AAElC;;;;;;;;;;;;GAYG;AACH,SAAgB,oBAAoB,CAClC,MAAe,EACf,WAAwB,EACxB,SAA6B;IAE7B,MAAM,MAAM,GAAG,IAAA,sBAAQ,EACrB;QACE,QAAQ,EAAE,CAAC,qBAAqB,EAAE,SAAS,CAAC;QAC5C,OAAO,EAAE,KAAK,IAAI,EAAE;YAClB,MAAM,YAAY,GAAG;gBACnB,UAAU,EAAE,iDAAiD;gBAC7D,qGAAqG;gBACrG,aAAa,EAAE,SAAU;gBACzB,kBAAkB,EAAE,+CAA+C;aACpE,CAAC;YACF,MAAM,uBAAuB,GAAG,IAAI,eAAe,CACjD,YAAY,CACb,CAAC,QAAQ,EAAE,CAAC;YACb,MAAM,kBAAkB,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CACjD,uBAAuB,CACxB,CAAC;YACF,OAAO,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,kBAAyB,CAAC,CAAC;QACpE,CAAC;QACD,OAAO,EAAE,CAAC,CAAC,SAAS;QACpB,eAAe,EAAE,CAAC,MAAM,EAAE,EAAE;YAC1B,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,UAAU,EAAE,CAAC;gBAClC,OAAO,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YAC7C,CAAC;YACD,OAAO,KAAK,CAAC;QACf,CAAC;KACF,EACD,WAAW,CACZ,CAAC;IACF,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,EAAE,YAAY,IAAI,IAAI,CAAC;IACtD,IAAA,iBAAS,EAAC,GAAG,EAAE;QACb,MAAM,CAAC,MAAM,GAAG,WAAW,CAAC;IAC9B,CAAC,EAAE,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC,CAAC;IAC1B,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["\"use client\";\nimport TamboAI from \"@tambo-ai/typescript-sdk\";\nimport { QueryClient, useQuery } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\n\n/**\n * This internal hook is used to get the Tambo session token and keep it\n * refreshed.\n *\n * It will refresh the token when it expires.\n * It will also set the bearer token on the client.\n *\n * This hook is used by the TamboClientProvider.\n * @param client - The Tambo client.\n * @param queryClient - The query client.\n * @param userToken - The third-party OAuth token to exchange for a Tambo session.\n * @returns React Query result for the session token (token data, fetching state, errors).\n */\nexport function useTamboSessionToken(\n  client: TamboAI,\n  queryClient: QueryClient,\n  userToken: string | undefined,\n) {\n  const result = useQuery(\n    {\n      queryKey: [\"tambo-session-token\", userToken],\n      queryFn: async () => {\n        const tokenRequest = {\n          grant_type: \"urn:ietf:params:oauth:grant-type:token-exchange\",\n          // will only be undefined if the userToken is not provided, in which case the query will be disabled.\n          subject_token: userToken!,\n          subject_token_type: \"urn:ietf:params:oauth:token-type:access_token\",\n        };\n        const tokenRequestFormEncoded = new URLSearchParams(\n          tokenRequest,\n        ).toString();\n        const tokenAsArrayBuffer = new TextEncoder().encode(\n          tokenRequestFormEncoded,\n        );\n        return await client.beta.auth.getToken(tokenAsArrayBuffer as any);\n      },\n      enabled: !!userToken,\n      refetchInterval: (result) => {\n        if (result.state.data?.expires_in) {\n          return result.state.data.expires_in * 1000;\n        }\n        return false;\n      },\n    },\n    queryClient,\n  );\n  const accessToken = result.data?.access_token ?? null;\n  useEffect(() => {\n    client.bearer = accessToken;\n  }, [accessToken, client]);\n  return result;\n}\n"]}
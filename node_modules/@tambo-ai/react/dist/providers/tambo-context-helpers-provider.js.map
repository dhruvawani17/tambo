{"version":3,"file":"tambo-context-helpers-provider.js","sourceRoot":"","sources":["../../src/providers/tambo-context-helpers-provider.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\";\nimport React, {\n  createContext,\n  PropsWithChildren,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport {\n  AdditionalContext,\n  ContextHelperFn,\n  ContextHelpers,\n} from \"../context-helpers\";\nimport { resolveAdditionalContext } from \"../context-helpers/registry\";\n\nexport interface TamboContextHelpersProviderProps {\n  /**\n   * A dictionary of context helper functions.\n   * The key becomes the AdditionalContext.name and the function returns the value.\n   * Return null/undefined to skip including that context.\n   */\n  contextHelpers?: ContextHelpers;\n}\n\nexport interface TamboContextHelpersContextProps {\n  /** Get all additional context by running all helper functions */\n  getAdditionalContext: () => Promise<AdditionalContext[]>;\n  /** Get the current context helpers map */\n  getContextHelpers: () => ContextHelpers;\n  /** Add or update a context helper by name */\n  addContextHelper: (name: string, helper: ContextHelperFn) => void;\n  /** Remove a context helper by name */\n  removeContextHelper: (name: string) => void;\n}\n\nconst TamboContextHelpersContext =\n  createContext<TamboContextHelpersContextProps | null>(null);\n\n/**\n * Provider for managing additional context helpers.\n * Accepts a map of { key: () => any | null | undefined | Promise<any | null | undefined> }.\n * Returning null/undefined skips inclusion; returned values are wrapped as { name: key, context: value }.\n * @param props - The props for the TamboContextHelpersProvider.\n * @param props.contextHelpers - A dictionary of context helper functions keyed by context name.\n * @param props.children - The children to render.\n * @returns The provider that exposes context helper APIs via useTamboContextHelpers.\n */\nexport const TamboContextHelpersProvider: React.FC<\n  PropsWithChildren<TamboContextHelpersProviderProps>\n> = ({ children, contextHelpers }) => {\n  const [helpers, setHelpers] = useState<Record<string, ContextHelperFn>>({});\n  const addContextHelper = useCallback((name: string, fn: ContextHelperFn) => {\n    setHelpers((prev) => ({ ...prev, [name]: fn }));\n  }, []);\n  const removeContextHelper = useCallback(\n    (name: string, fn?: ContextHelperFn) => {\n      setHelpers((prev) => {\n        const { [name]: registeredFn, ...rest } = prev;\n        if (fn === undefined || registeredFn === fn) {\n          return rest;\n        }\n        return prev;\n      });\n    },\n    [],\n  );\n  // Hydrate the global registry with initial helpers (runs on prop changes)\n  useEffect(() => {\n    const addedEntries: [string, ContextHelperFn][] = [];\n\n    if (contextHelpers) {\n      for (const [name, fn] of Object.entries(contextHelpers)) {\n        addContextHelper(name, fn);\n        addedEntries.push([name, fn]);\n      }\n    }\n\n    return () => {\n      for (const [name, fn] of addedEntries) {\n        // Only remove if the registry still points to the same function\n        removeContextHelper(name, fn);\n      }\n    };\n  }, [addContextHelper, contextHelpers, removeContextHelper]);\n\n  const getAdditionalContext = useCallback(async () => {\n    const contexts = await resolveAdditionalContext(helpers);\n    return contexts as AdditionalContext[];\n  }, [helpers]);\n\n  const getContextHelpers = useCallback(() => {\n    return helpers as ContextHelpers;\n  }, [helpers]);\n\n  const value = useMemo(\n    () => ({\n      getAdditionalContext,\n      getContextHelpers,\n      addContextHelper,\n      removeContextHelper,\n    }),\n    [\n      getAdditionalContext,\n      getContextHelpers,\n      addContextHelper,\n      removeContextHelper,\n    ],\n  );\n\n  return (\n    <TamboContextHelpersContext.Provider value={value}>\n      {children}\n    </TamboContextHelpersContext.Provider>\n  );\n};\n\n/**\n * Hook to access context helpers functionality.\n *\n * Behavior without a provider: this hook does NOT throw immediately. If it is\n * called outside of a `TamboContextHelpersProvider`, it returns a fallback\n * object whose methods will throw when invoked. This \"lazy-throw\" pattern is\n * intentional so the error surfaces at the actual point of use.\n * @returns The context helpers API when a provider is present; otherwise, a\n * fallback object whose methods throw if called.\n */\nexport const useTamboContextHelpers = () => {\n  const context = useContext(TamboContextHelpersContext);\n  if (context) return context;\n\n  // No provider present: return methods that throw with a helpful error when used\n  return {\n    getAdditionalContext: async () => {\n      throw new Error(\n        \"useTamboContextHelpers must be used within a TamboContextHelpersProvider\",\n      );\n    },\n    getContextHelpers: () => {\n      throw new Error(\n        \"useTamboContextHelpers must be used within a TamboContextHelpersProvider\",\n      );\n    },\n    addContextHelper: (_name: string, _helper: ContextHelperFn) => {\n      throw new Error(\n        \"useTamboContextHelpers must be used within a TamboContextHelpersProvider\",\n      );\n    },\n    removeContextHelper: (_name: string) => {\n      throw new Error(\n        \"useTamboContextHelpers must be used within a TamboContextHelpersProvider\",\n      );\n    },\n  } as TamboContextHelpersContextProps;\n};\n"]}
{"version":3,"file":"elicitation.test.js","sourceRoot":"","sources":["../../src/mcp/elicitation.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { RequestHandlerExtra } from \"@modelcontextprotocol/sdk/shared/protocol.js\";\nimport type {\n  ClientNotification,\n  ClientRequest,\n  ElicitRequest,\n} from \"@modelcontextprotocol/sdk/types.js\";\nimport { act, renderHook } from \"@testing-library/react\";\nimport {\n  useElicitation,\n  type TamboElicitationRequest,\n  type TamboElicitationResponse,\n} from \"./elicitation\";\n\n// Create a mock RequestHandlerExtra for testing\nfunction createMockExtra(): RequestHandlerExtra<\n  ClientRequest,\n  ClientNotification\n> {\n  return {\n    signal: new AbortController().signal,\n    requestId: \"test-request-id\",\n\n    sendNotification: (async () => {}) as any,\n\n    sendRequest: (async () => ({ _meta: {} })) as any,\n  };\n}\n\ndescribe(\"useElicitation\", () => {\n  it(\"initializes with null state\", () => {\n    const { result } = renderHook(() => useElicitation());\n\n    expect(result.current.elicitation).toBeNull();\n    expect(result.current.resolveElicitation).toBeNull();\n  });\n\n  it(\"provides state setters\", () => {\n    const { result } = renderHook(() => useElicitation());\n\n    expect(typeof result.current.setElicitation).toBe(\"function\");\n    expect(typeof result.current.setResolveElicitation).toBe(\"function\");\n  });\n\n  it(\"provides a default elicitation handler\", () => {\n    const { result } = renderHook(() => useElicitation());\n\n    expect(typeof result.current.defaultElicitationHandler).toBe(\"function\");\n  });\n\n  describe(\"defaultElicitationHandler\", () => {\n    it(\"sets elicitation state when called\", async () => {\n      const { result } = renderHook(() => useElicitation());\n\n      const request: ElicitRequest = {\n        method: \"elicitation/create\",\n        params: {\n          message: \"Please provide your name\",\n          requestedSchema: {\n            type: \"object\",\n            properties: {\n              name: { type: \"string\", description: \"Your name\" },\n            },\n            required: [\"name\"],\n          },\n        },\n      };\n\n      // Start the handler but don't await yet\n      let handlerPromise: Promise<TamboElicitationResponse>;\n      const extra = createMockExtra();\n      act(() => {\n        handlerPromise = result.current.defaultElicitationHandler(\n          request,\n          extra,\n        );\n      });\n\n      // Elicitation should be set\n      const requestedSchema =\n        \"requestedSchema\" in request.params\n          ? request.params.requestedSchema\n          : null;\n\n      expect(requestedSchema).not.toBeNull();\n\n      if (requestedSchema === null) {\n        return;\n      }\n\n      expect(result.current.elicitation).toEqual({\n        message: \"Please provide your name\",\n        requestedSchema,\n        signal: extra.signal,\n      });\n\n      // Resolve callback should be set\n      expect(result.current.resolveElicitation).not.toBeNull();\n\n      // Clean up by resolving\n      act(() => {\n        result.current.resolveElicitation?.({\n          action: \"cancel\",\n        });\n      });\n\n      await handlerPromise!;\n    });\n\n    it(\"resolves promise when resolveElicitation is called with accept\", async () => {\n      const { result } = renderHook(() => useElicitation());\n\n      const request: ElicitRequest = {\n        method: \"elicitation/create\",\n        params: {\n          message: \"Enter your email\",\n          requestedSchema: {\n            type: \"object\",\n            properties: {\n              email: {\n                type: \"string\",\n                format: \"email\",\n                description: \"Email address\",\n              },\n            },\n          },\n        },\n      };\n\n      // Start the handler\n      let handlerPromise: Promise<TamboElicitationResponse>;\n      const extra = createMockExtra();\n      act(() => {\n        handlerPromise = result.current.defaultElicitationHandler(\n          request,\n          extra,\n        );\n      });\n\n      // Resolve with accept\n      const response: TamboElicitationResponse = {\n        action: \"accept\",\n        content: { email: \"test@example.com\" },\n      };\n\n      act(() => {\n        result.current.resolveElicitation?.(response);\n      });\n\n      // Wait for promise to resolve\n      const resolvedValue = await handlerPromise!;\n\n      expect(resolvedValue).toEqual(response);\n    });\n\n    it(\"resolves promise when resolveElicitation is called with decline\", async () => {\n      const { result } = renderHook(() => useElicitation());\n\n      const request: ElicitRequest = {\n        method: \"elicitation/create\",\n        params: {\n          message: \"Provide input\",\n          requestedSchema: {\n            type: \"object\",\n            properties: {\n              value: { type: \"string\" },\n            },\n          },\n        },\n      };\n\n      let handlerPromise: Promise<TamboElicitationResponse>;\n      const extra = createMockExtra();\n      act(() => {\n        handlerPromise = result.current.defaultElicitationHandler(\n          request,\n          extra,\n        );\n      });\n\n      const response: TamboElicitationResponse = {\n        action: \"decline\",\n      };\n\n      act(() => {\n        result.current.resolveElicitation?.(response);\n      });\n\n      const resolvedValue = await handlerPromise!;\n\n      expect(resolvedValue).toEqual(response);\n    });\n\n    it(\"resolves promise when resolveElicitation is called with cancel\", async () => {\n      const { result } = renderHook(() => useElicitation());\n\n      const request: ElicitRequest = {\n        method: \"elicitation/create\",\n        params: {\n          message: \"Provide input\",\n          requestedSchema: {\n            type: \"object\",\n            properties: {\n              value: { type: \"string\" },\n            },\n          },\n        },\n      };\n\n      let handlerPromise: Promise<TamboElicitationResponse>;\n      const extra = createMockExtra();\n      act(() => {\n        handlerPromise = result.current.defaultElicitationHandler(\n          request,\n          extra,\n        );\n      });\n\n      const response: TamboElicitationResponse = {\n        action: \"cancel\",\n      };\n\n      act(() => {\n        result.current.resolveElicitation?.(response);\n      });\n\n      const resolvedValue = await handlerPromise!;\n\n      expect(resolvedValue).toEqual(response);\n    });\n\n    it(\"handles multiple sequential elicitations\", async () => {\n      const { result } = renderHook(() => useElicitation());\n\n      // First elicitation\n      const request1: ElicitRequest = {\n        method: \"elicitation/create\",\n        params: {\n          message: \"First request\",\n          requestedSchema: {\n            type: \"object\",\n            properties: {\n              field1: { type: \"string\" },\n            },\n          },\n        },\n      };\n\n      let promise1: Promise<TamboElicitationResponse>;\n      const extra1 = createMockExtra();\n      act(() => {\n        promise1 = result.current.defaultElicitationHandler(request1, extra1);\n      });\n\n      expect(result.current.elicitation?.message).toBe(\"First request\");\n\n      act(() => {\n        result.current.resolveElicitation?.({\n          action: \"accept\",\n          content: { field1: \"value1\" },\n        });\n      });\n\n      const result1 = await promise1!;\n      expect(result1).toEqual({\n        action: \"accept\",\n        content: { field1: \"value1\" },\n      });\n\n      // Second elicitation\n      const request2: ElicitRequest = {\n        method: \"elicitation/create\",\n        params: {\n          message: \"Second request\",\n          requestedSchema: {\n            type: \"object\",\n            properties: { field2: { type: \"number\" } },\n          },\n        },\n      };\n\n      let promise2: Promise<TamboElicitationResponse>;\n      const extra2 = createMockExtra();\n      act(() => {\n        promise2 = result.current.defaultElicitationHandler(request2, extra2);\n      });\n\n      expect(result.current.elicitation?.message).toBe(\"Second request\");\n\n      act(() => {\n        result.current.resolveElicitation?.({\n          action: \"accept\",\n          content: { field2: 42 },\n        });\n      });\n\n      const result2 = await promise2!;\n      expect(result2).toEqual({\n        action: \"accept\",\n        content: { field2: 42 },\n      });\n    });\n\n    it(\"maintains stable handler reference across re-renders\", () => {\n      const { result, rerender } = renderHook(() => useElicitation());\n\n      const firstHandler = result.current.defaultElicitationHandler;\n\n      rerender();\n\n      const secondHandler = result.current.defaultElicitationHandler;\n\n      expect(firstHandler).toBe(secondHandler);\n    });\n  });\n\n  describe(\"state management\", () => {\n    it(\"allows manual state updates via setElicitation\", () => {\n      const { result } = renderHook(() => useElicitation());\n\n      const customElicitation: TamboElicitationRequest = {\n        message: \"Custom message\",\n        requestedSchema: {\n          type: \"object\",\n          properties: {\n            custom: { type: \"boolean\" },\n          },\n        },\n      };\n\n      act(() => {\n        result.current.setElicitation(customElicitation);\n      });\n\n      expect(result.current.elicitation).toEqual(customElicitation);\n    });\n\n    it(\"allows clearing elicitation state\", () => {\n      const { result } = renderHook(() => useElicitation());\n\n      const elicitation: TamboElicitationRequest = {\n        message: \"Test\",\n        requestedSchema: {\n          type: \"object\",\n          properties: {},\n        },\n      };\n\n      act(() => {\n        result.current.setElicitation(elicitation);\n      });\n\n      expect(result.current.elicitation).not.toBeNull();\n\n      act(() => {\n        result.current.setElicitation(null);\n      });\n\n      expect(result.current.elicitation).toBeNull();\n    });\n  });\n});\n"]}
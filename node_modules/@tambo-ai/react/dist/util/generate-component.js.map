{"version":3,"file":"generate-component.js","sourceRoot":"","sources":["../../src/util/generate-component.ts"],"names":[],"mappings":";;;;;AAiBA,gEA2DC;AA3ED,+CAAqC;AACrC,kDAA0B;AAC1B,sEAA4E;AAG5E,sCAA6C;AAC7C,mDAA+C;AAC/C,+CAA4D;AAE5D;;;;;;GAMG;AACH,SAAgB,0BAA0B,CACxC,OAA2C,EAC3C,aAAgC;IAEhC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,aAAa,EAAE,CAAC;QACtC,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;IACzC,CAAC;IACD,MAAM,WAAW,GAAG,IAAA,oBAAK,EAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;IACnE,MAAM,mBAAmB,GAAG,IAAA,mCAAwB,EAClD,OAAO,CAAC,SAAS,CAAC,aAAa,EAC/B,aAAa,CACd,CAAC;IAEF,IAAI,cAAc,GAA4B,WAG7C,CAAC;IACF,IAAI,IAAA,yBAAgB,EAAC,mBAAmB,CAAC,KAAK,CAAC,EAAE,CAAC;QAChD,MAAM,MAAM,GAAG,mBAAmB,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAC5E,6FAA6F;QAC7F,4DAA4D;QAC5D,IAAI,IAAA,sBAAS,EAAC,MAAM,CAAC,EAAE,CAAC;YACtB,MAAM,IAAI,KAAK,CACb,8DAA8D,CAC/D,CAAC;QACJ,CAAC;QACD,IAAI,OAAO,IAAI,MAAM,EAAE,CAAC;YACtB,cAAc,GAAG,MAAM,CAAC,KAAgC,CAAC;QAC3D,CAAC;aAAM,CAAC;YACN,qDAAqD;YACrD,MAAM,YAAY,GAChB,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,OAAO,IAAI,0BAA0B,CAAC;YAC5D,MAAM,IAAI,KAAK,CAAC,sCAAsC,YAAY,EAAE,CAAC,CAAC;QACxE,CAAC;IACH,CAAC;IAED,MAAM,iBAAiB,GAAG,eAAK,CAAC,aAAa,CAC3C,mBAAmB,CAAC,SAAS,EAC7B,cAAc,CACf,CAAC;IAEF,yEAAyE;IACzE,MAAM,WAAW,GAAuB;QACtC,GAAG,OAAO;QACV,SAAS,EAAE;YACT,GAAG,OAAO,CAAC,SAAS;YACpB,KAAK,EAAE,cAAc;SACtB;KACF,CAAC;IAEF,MAAM,gBAAgB,GAAG,IAAA,kDAA4B,EACnD,iBAAiB,EACjB,WAAW,CACZ,CAAC;IAEF,OAAO;QACL,GAAG,WAAW;QACd,iBAAiB,EAAE,gBAAgB;KACpC,CAAC;AACJ,CAAC","sourcesContent":["import TamboAI from \"@tambo-ai/typescript-sdk\";\nimport { parse } from \"partial-json\";\nimport React from \"react\";\nimport { wrapWithTamboMessageProvider } from \"../hooks/use-current-message\";\nimport { ComponentRegistry } from \"../model/component-metadata\";\nimport { TamboThreadMessage } from \"../model/generate-component-response\";\nimport { isStandardSchema } from \"../schema\";\nimport { isPromise } from \"../util/is-promise\";\nimport { getComponentFromRegistry } from \"../util/registry\";\n\n/**\n * Generate a message that has a component rendered into it, if the message\n * came with one.\n * @param message - The message that may contain a component\n * @param componentList - the list of available components\n * @returns The updated message with the component rendered into it\n */\nexport function renderComponentIntoMessage(\n  message: TamboAI.Beta.Threads.ThreadMessage,\n  componentList: ComponentRegistry,\n): TamboThreadMessage {\n  if (!message.component?.componentName) {\n    throw new Error(\"Component not found\");\n  }\n  const parsedProps = parse(JSON.stringify(message.component.props));\n  const registeredComponent = getComponentFromRegistry(\n    message.component.componentName,\n    componentList,\n  );\n\n  let validatedProps: Record<string, unknown> = parsedProps as Record<\n    string,\n    unknown\n  >;\n  if (isStandardSchema(registeredComponent.props)) {\n    const result = registeredComponent.props[\"~standard\"].validate(parsedProps);\n    // Standard Schema validate() returns { value: T } on success or { issues: [...] } on failure\n    // Async validation is not supported for component rendering\n    if (isPromise(result)) {\n      throw new Error(\n        \"Async schema validation is not supported for component props\",\n      );\n    }\n    if (\"value\" in result) {\n      validatedProps = result.value as Record<string, unknown>;\n    } else {\n      // Validation failed - throw with first issue message\n      const issueMessage =\n        result.issues?.[0]?.message ?? \"Schema validation failed\";\n      throw new Error(`Component props validation failed: ${issueMessage}`);\n    }\n  }\n\n  const renderedComponent = React.createElement(\n    registeredComponent.component,\n    validatedProps,\n  );\n\n  // Create the full message object first so we can pass it to the provider\n  const fullMessage: TamboThreadMessage = {\n    ...message,\n    component: {\n      ...message.component,\n      props: validatedProps,\n    },\n  };\n\n  const wrappedComponent = wrapWithTamboMessageProvider(\n    renderedComponent,\n    fullMessage,\n  );\n\n  return {\n    ...fullMessage,\n    renderedComponent: wrappedComponent,\n  };\n}\n"]}
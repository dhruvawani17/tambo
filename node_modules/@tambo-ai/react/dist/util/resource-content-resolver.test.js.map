{"version":3,"file":"resource-content-resolver.test.js","sourceRoot":"","sources":["../../src/util/resource-content-resolver.test.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReadResourceResult } from \"@modelcontextprotocol/sdk/types.js\";\nimport { ServerType } from \"../mcp/mcp-constants\";\nimport type { McpServer } from \"../mcp/tambo-mcp-provider\";\nimport type { ResourceSource } from \"../model/resource-info\";\nimport { MCPTransport } from \"../mcp/mcp-client\";\n\nimport {\n  resolveResourceContents,\n  extractResourceUris,\n} from \"./resource-content-resolver\";\n\ndescribe(\"extractResourceUris\", () => {\n  it(\"should extract a single resource URI\", () => {\n    const text = \"Check @registry:file:///path/to/doc.txt\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([\"registry:file:///path/to/doc.txt\"]);\n  });\n\n  it(\"should extract multiple resource URIs\", () => {\n    const text =\n      \"Check @registry:file:///doc1.txt and @server-a:file:///doc2.txt\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([\n      \"registry:file:///doc1.txt\",\n      \"server-a:file:///doc2.txt\",\n    ]);\n  });\n\n  it(\"should extract resource URIs with internal server prefix\", () => {\n    const text = \"Check @tambo-abc123:tambo:test://resource/1\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([\"tambo-abc123:tambo:test://resource/1\"]);\n  });\n\n  it(\"should extract resource URIs with hyphens in server key\", () => {\n    const text = \"@my-mcp-server:file:///path/file.txt\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([\"my-mcp-server:file:///path/file.txt\"]);\n  });\n\n  it(\"should return empty array for text without resource references\", () => {\n    const text = \"Just some regular text without @mentions\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([]);\n  });\n\n  it(\"should not extract malformed references without colon\", () => {\n    const text = \"@server-without-colon is not a resource\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([]);\n  });\n\n  it(\"should handle URIs with multiple colons\", () => {\n    const text = \"@server:http://example.com:8080/path\";\n    const result = extractResourceUris(text);\n    expect(result).toEqual([\"server:http://example.com:8080/path\"]);\n  });\n});\n\ndescribe(\"resolveResourceContents\", () => {\n  const createMockConnectedServer = (\n    serverKey: string,\n    readResource: jest.Mock,\n    serverType: ServerType = ServerType.BROWSER_SIDE,\n  ): McpServer =>\n    ({\n      key: `mcp-${serverKey}`,\n      serverKey,\n      url: `https://${serverKey}.example.com`,\n      name: `MCP Server ${serverKey}`,\n      transport: MCPTransport.HTTP,\n      serverType,\n      client: {\n        client: {\n          readResource,\n          listResources: jest.fn().mockResolvedValue({ resources: [] }),\n          listTools: jest.fn().mockResolvedValue({ tools: [] }),\n          listPrompts: jest.fn().mockResolvedValue({ prompts: [] }),\n          getPrompt: jest.fn().mockResolvedValue(null),\n          callTool: jest.fn().mockResolvedValue(null),\n        },\n        close: jest.fn().mockResolvedValue(undefined),\n      } as unknown as McpServer[\"client\"],\n    }) as McpServer;\n\n  const createMockInternalServer = (serverKey: string): McpServer =>\n    ({\n      key: serverKey,\n      serverKey,\n      url: \"https://api.tambo.ai/mcp\",\n      name: \"__tambo_internal_mcp_server__\",\n      transport: MCPTransport.HTTP,\n      serverType: ServerType.TAMBO_INTERNAL,\n      connectionError: undefined, // No client for internal servers\n    }) as unknown as McpServer;\n\n  const createMockResourceSource = (\n    getResource: jest.Mock,\n  ): ResourceSource => ({\n    listResources: jest.fn().mockResolvedValue([]),\n    getResource,\n  });\n\n  it(\"should resolve registry resources via resourceSource\", async () => {\n    const mockGetResource = jest.fn().mockResolvedValue({\n      contents: [\n        {\n          uri: \"file:///local/doc.txt\",\n          mimeType: \"text/plain\",\n          text: \"Registry document content\",\n        },\n      ],\n    } satisfies ReadResourceResult);\n\n    const resourceSource = createMockResourceSource(mockGetResource);\n\n    const result = await resolveResourceContents(\n      [\"registry:file:///local/doc.txt\"],\n      [], // Registry resources don't need a server - they're handled directly\n      resourceSource,\n    );\n\n    expect(mockGetResource).toHaveBeenCalledWith(\"file:///local/doc.txt\");\n    expect(result.size).toBe(1);\n    expect(result.get(\"registry:file:///local/doc.txt\")).toEqual({\n      contents: [\n        {\n          uri: \"file:///local/doc.txt\",\n          mimeType: \"text/plain\",\n          text: \"Registry document content\",\n        },\n      ],\n    });\n  });\n\n  it(\"should resolve client-side MCP resources via mcpServer\", async () => {\n    const mockReadResource = jest.fn().mockResolvedValue({\n      contents: [\n        {\n          uri: \"file:///mcp/file.txt\",\n          mimeType: \"text/plain\",\n          text: \"MCP server content\",\n        },\n      ],\n    } satisfies ReadResourceResult);\n\n    const mcpServer = createMockConnectedServer(\"linear\", mockReadResource);\n\n    const result = await resolveResourceContents(\n      [\"linear:file:///mcp/file.txt\"],\n      [mcpServer],\n      undefined,\n    );\n\n    expect(mockReadResource).toHaveBeenCalledWith({\n      uri: \"file:///mcp/file.txt\",\n    });\n    expect(result.size).toBe(1);\n    expect(result.get(\"linear:file:///mcp/file.txt\")).toEqual({\n      contents: [\n        {\n          uri: \"file:///mcp/file.txt\",\n          mimeType: \"text/plain\",\n          text: \"MCP server content\",\n        },\n      ],\n    });\n  });\n\n  it(\"should skip internal server resources (serverType: TAMBO_INTERNAL)\", async () => {\n    const mockGetResource = jest.fn();\n    const resourceSource = createMockResourceSource(mockGetResource);\n    const internalServer = createMockInternalServer(\"tambo-abc123\");\n\n    const result = await resolveResourceContents(\n      [\"tambo-abc123:tambo:test://resource/1\"],\n      [internalServer],\n      resourceSource,\n    );\n\n    // Should not call getResource for internal server resources\n    expect(mockGetResource).not.toHaveBeenCalled();\n    // Should return empty map since internal resources are skipped\n    expect(result.size).toBe(0);\n  });\n\n  it(\"should resolve multiple resources in parallel\", async () => {\n    const mockGetResource = jest.fn().mockResolvedValue({\n      contents: [{ uri: \"file:///doc.txt\", text: \"registry content\" }],\n    });\n    const mockReadResource = jest.fn().mockResolvedValue({\n      contents: [{ uri: \"file:///mcp.txt\", text: \"mcp content\" }],\n    });\n\n    const resourceSource = createMockResourceSource(mockGetResource);\n    const mcpServer = createMockConnectedServer(\"mcp-server\", mockReadResource);\n\n    const result = await resolveResourceContents(\n      [\"registry:file:///doc.txt\", \"mcp-server:file:///mcp.txt\"],\n      [mcpServer], // Only MCP server needed - registry handled directly\n      resourceSource,\n    );\n\n    expect(result.size).toBe(2);\n    expect(result.has(\"registry:file:///doc.txt\")).toBe(true);\n    expect(result.has(\"mcp-server:file:///mcp.txt\")).toBe(true);\n  });\n\n  it(\"should handle mixed internal and client-side resources\", async () => {\n    const mockGetResource = jest.fn().mockResolvedValue({\n      contents: [{ uri: \"file:///doc.txt\", text: \"registry content\" }],\n    });\n    const resourceSource = createMockResourceSource(mockGetResource);\n    const internalServer = createMockInternalServer(\"tambo-abc123\");\n\n    const result = await resolveResourceContents(\n      [\n        \"registry:file:///doc.txt\", // client-side registry\n        \"tambo-abc123:tambo:test://resource/1\", // internal - should skip\n      ],\n      [internalServer], // Only internal server needed - registry handled directly\n      resourceSource,\n    );\n\n    // Only the registry resource should be resolved\n    expect(mockGetResource).toHaveBeenCalledTimes(1);\n    expect(result.size).toBe(1);\n    expect(result.has(\"registry:file:///doc.txt\")).toBe(true);\n    expect(result.has(\"tambo-abc123:tambo:test://resource/1\")).toBe(false);\n  });\n\n  it(\"should gracefully handle registry resource fetch failure\", async () => {\n    const consoleSpy = jest.spyOn(console, \"warn\").mockImplementation();\n    const mockGetResource = jest\n      .fn()\n      .mockRejectedValue(new Error(\"Resource not found\"));\n    const resourceSource = createMockResourceSource(mockGetResource);\n\n    const result = await resolveResourceContents(\n      [\"registry:file:///missing.txt\"],\n      [], // Registry resources don't need a server\n      resourceSource,\n    );\n\n    expect(consoleSpy).toHaveBeenCalledWith(\n      \"Failed to fetch resource content for registry:file:///missing.txt:\",\n      expect.any(Error),\n    );\n    expect(result.size).toBe(0);\n\n    consoleSpy.mockRestore();\n  });\n\n  it(\"should gracefully handle MCP resource fetch failure\", async () => {\n    const consoleSpy = jest.spyOn(console, \"warn\").mockImplementation();\n    const mockReadResource = jest\n      .fn()\n      .mockRejectedValue(new Error(\"MCP server error\"));\n    const mcpServer = createMockConnectedServer(\"linear\", mockReadResource);\n\n    const result = await resolveResourceContents(\n      [\"linear:file:///missing.txt\"],\n      [mcpServer],\n      undefined,\n    );\n\n    expect(consoleSpy).toHaveBeenCalledWith(\n      \"Failed to fetch resource content for linear:file:///missing.txt:\",\n      expect.any(Error),\n    );\n    expect(result.size).toBe(0);\n\n    consoleSpy.mockRestore();\n  });\n\n  it(\"should warn when no resourceSource available for registry resource\", async () => {\n    const consoleSpy = jest.spyOn(console, \"warn\").mockImplementation();\n\n    const result = await resolveResourceContents(\n      [\"registry:file:///doc.txt\"],\n      [], // Registry resources don't need a server\n      undefined, // no resourceSource\n    );\n\n    expect(consoleSpy).toHaveBeenCalledWith(\n      \"No resource source available to resolve registry resource: registry:file:///doc.txt\",\n    );\n    expect(result.size).toBe(0);\n\n    consoleSpy.mockRestore();\n  });\n\n  it(\"should warn when no server found for resource\", async () => {\n    const consoleSpy = jest.spyOn(console, \"warn\").mockImplementation();\n\n    const result = await resolveResourceContents(\n      [\"unknown-server:file:///doc.txt\"],\n      [], // no servers\n      undefined,\n    );\n\n    expect(consoleSpy).toHaveBeenCalledWith(\n      \"No server found for resource: unknown-server:file:///doc.txt\",\n    );\n    expect(result.size).toBe(0);\n\n    consoleSpy.mockRestore();\n  });\n\n  it(\"should handle resource content with blob data\", async () => {\n    const mockGetResource = jest.fn().mockResolvedValue({\n      contents: [\n        {\n          uri: \"file:///image.png\",\n          mimeType: \"image/png\",\n          blob: \"base64encodeddata\",\n        },\n      ],\n    } satisfies ReadResourceResult);\n\n    const resourceSource = createMockResourceSource(mockGetResource);\n\n    const result = await resolveResourceContents(\n      [\"registry:file:///image.png\"],\n      [], // Registry resources don't need a server\n      resourceSource,\n    );\n\n    expect(result.get(\"registry:file:///image.png\")).toEqual({\n      contents: [\n        {\n          uri: \"file:///image.png\",\n          mimeType: \"image/png\",\n          blob: \"base64encodeddata\",\n        },\n      ],\n    });\n  });\n\n  it(\"should handle URIs with no colon (invalid format)\", async () => {\n    const result = await resolveResourceContents(\n      [\"invalid-uri-no-colon\"],\n      [],\n      undefined,\n    );\n\n    expect(result.size).toBe(0);\n  });\n\n  it(\"should handle null content from getResource\", async () => {\n    const mockGetResource = jest.fn().mockResolvedValue(null);\n    const resourceSource = createMockResourceSource(mockGetResource);\n\n    const result = await resolveResourceContents(\n      [\"registry:file:///doc.txt\"],\n      [], // Registry resources don't need a server\n      resourceSource,\n    );\n\n    expect(mockGetResource).toHaveBeenCalled();\n    expect(result.size).toBe(0);\n  });\n\n  it(\"should handle null content from readResource\", async () => {\n    const mockReadResource = jest.fn().mockResolvedValue(null);\n    const mcpServer = createMockConnectedServer(\"linear\", mockReadResource);\n\n    const result = await resolveResourceContents(\n      [\"linear:file:///doc.txt\"],\n      [mcpServer],\n      undefined,\n    );\n\n    expect(mockReadResource).toHaveBeenCalled();\n    expect(result.size).toBe(0);\n  });\n});\n"]}
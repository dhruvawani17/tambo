{"version":3,"file":"generate-component.test.js","sourceRoot":"","sources":["../../src/util/generate-component.test.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,kDAA0B;AAE1B,gFAAkE;AAClE,6DAAkE;AAElE,8CAA8C;AAC9C,IAAI,+BAAiD,CAAC;AAEtD,UAAU,CAAC,GAAG,EAAE;IACd,+BAA+B,GAAG,IAAI,CAAC,KAAK,CAC1C,iBAAiB,EACjB,8BAA8B,CAC/B,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,SAAS,CAAC,GAAG,EAAE;IACb,+BAA+B,CAAC,WAAW,EAAE,CAAC;AAChD,CAAC,CAAC,CAAC;AAEH,wBAAwB;AACxB,MAAM,aAAa,GAAgD,CAAC,EAClE,KAAK,EACL,KAAK,GACN,EAAE,EAAE,CAAC,CACJ,sDAAiB,gBAAgB;IAC/B,4CAAO,KAAK,CAAQ;IACnB,KAAK,KAAK,SAAS,IAAI,4CAAO,KAAK,CAAQ,CACxC,CACP,CAAC;AAEF,4CAA4C;AAC5C,MAAM,wBAAwB,GAAG,CAAC,QAAoC,EAAE,EAAE,CAAC,CAAC;IAC1E,WAAW,EAAE;QACX,OAAO,EAAE,CAAC;QACV,MAAM,EAAE,MAAM;QACd,QAAQ,EAAE,CAAC,IAAa,EAAE,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC;KACzD;CACF,CAAC,CAAC;AAEH,QAAQ,CAAC,4BAA4B,EAAE,GAAG,EAAE;IAC1C,MAAM,WAAW,GAAG;QAClB,EAAE,EAAE,SAAS;QACb,QAAQ,EAAE,YAAY;QACtB,IAAI,EAAE,WAAW;QACjB,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,wBAAwB,EAAE,CAAC;QAC3D,SAAS,EAAE,sBAAsB;QACjC,cAAc,EAAE,EAAE;QAClB,SAAS,EAAE;YACT,aAAa,EAAE,eAAe;YAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,OAAO,EAAE;YACzB,cAAc,EAAE,EAAE;YAClB,OAAO,EAAE,EAAE;SACZ;KAC+C,CAAC;IAEnD,MAAM,YAAY,GAAsB;QACtC,aAAa,EAAE;YACb,IAAI,EAAE,eAAe;YACrB,WAAW,EAAE,kBAAkB;YAC/B,SAAS,EAAE,aAAa;YACxB,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,EAAE,cAAc;YACzC,YAAY,EAAE,EAAE;SACjB;KACF,CAAC;IAEF,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAChC,EAAE,CAAC,kDAAkD,EAAE,GAAG,EAAE;YAC1D,MAAM,2BAA2B,GAAG;gBAClC,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,EAAE;oBACjB,KAAK,EAAE,EAAE;oBACT,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,CAAC,GAAG,EAAE,CACV,IAAA,+CAA0B,EAAC,2BAA2B,EAAE,YAAY,CAAC,CACtE,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qCAAqC,EAAE,GAAG,EAAE;YAC7C,MAAM,wBAAwB,GAAG;gBAC/B,GAAG,WAAW;gBACd,SAAS,EAAE,IAAW;aACvB,CAAC;YAEF,MAAM,CAAC,GAAG,EAAE,CACV,IAAA,+CAA0B,EAAC,wBAAwB,EAAE,YAAY,CAAC,CACnE,CAAC,OAAO,EAAE,CAAC;QACd,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iDAAiD,EAAE,GAAG,EAAE;YACzD,MAAM,2BAA2B,GAAG;gBAClC,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,kBAAkB;oBACjC,KAAK,EAAE,EAAE;oBACT,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,CAAC,GAAG,EAAE,CACV,IAAA,+CAA0B,EAAC,2BAA2B,EAAE,YAAY,CAAC,CACtE,CAAC,OAAO,CACP,qEAAqE,CACtE,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qDAAqD,EAAE,GAAG,EAAE;YAC7D,MAAM,MAAM,GAAG,IAAA,+CAA0B,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;YAErE,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YAC9D,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,WAAW,EAAE,CAAC;QACjD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,wCAAwC,EAAE,GAAG,EAAE;YAChD,MAAM,gBAAgB,GAAG;gBACvB,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,YAAY,EAAE,KAAK,EAAE,EAAE,EAAE;oBACzC,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EAAC,gBAAgB,EAAE,YAAY,CAAC,CAAC;YAE1E,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC;gBACtC,KAAK,EAAE,YAAY;gBACnB,KAAK,EAAE,EAAE;aACV,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4BAA4B,EAAE,GAAG,EAAE;YACpC,MAAM,qBAAqB,GAAG;gBAC5B,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE,EAAE;oBACT,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,qBAAqB,EACrB,YAAY,CACb,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;YACrC,MAAM,sBAAsB,GAAG;gBAC7B,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE;wBACL,KAAK,EAAE,QAAQ;wBACf,MAAM,EAAE,EAAE,MAAM,EAAE,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,EAAE;qBAC/C;oBACD,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,sBAAsB,EACtB,YAAY,CACb,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC;gBACtC,KAAK,EAAE,QAAQ;gBACf,MAAM,EAAE,EAAE,MAAM,EAAE,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,EAAE;aAC/C,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qBAAqB,EAAE,GAAG,EAAE;YAC7B,MAAM,qBAAqB,GAAG;gBAC5B,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE;oBAChD,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,qBAAqB,EACrB,YAAY,CACb,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC;gBACtC,KAAK,EAAE,YAAY;gBACnB,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;aACjB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,4BAA4B,EAAE,GAAG,EAAE;QAC1C,EAAE,CAAC,sDAAsD,EAAE,GAAG,EAAE;YAC9D,MAAM,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;gBACtC,GAAG,IAAI;gBACP,SAAS,EAAE,IAAI;aAChB,CAAC,CAAC,CAAC;YAEJ,MAAM,0BAA0B,GAAsB;gBACpD,aAAa,EAAE;oBACb,IAAI,EAAE,eAAe;oBACrB,WAAW,EAAE,kBAAkB;oBAC/B,SAAS,EAAE,aAAa;oBACxB,KAAK,EAAE,wBAAwB,CAAC,YAAY,CAAC;oBAC7C,YAAY,EAAE,EAAE;iBACjB;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,WAAW,EACX,0BAA0B,CAC3B,CAAC;YAEF,MAAM,CAAC,YAAY,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACxC,sEAAsE;YACtE,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC;gBACtC,KAAK,EAAE,OAAO;gBACd,SAAS,EAAE,IAAI;aAChB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6CAA6C,EAAE,GAAG,EAAE;YACrD,MAAM,yBAAyB,GAAsB;gBACnD,aAAa,EAAE;oBACb,IAAI,EAAE,eAAe;oBACrB,WAAW,EAAE,kBAAkB;oBAC/B,SAAS,EAAE,aAAa;oBACxB,KAAK,EAAE;wBACL,WAAW,EAAE;4BACX,OAAO,EAAE,CAAC;4BACV,MAAM,EAAE,MAAM;4BACd,QAAQ,EAAE,GAAG,EAAE,CAAC,CAAC;gCACf,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,mBAAmB,EAAE,IAAI,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC;6BAC5D,CAAC;yBACH;qBACF;oBACD,YAAY,EAAE,EAAE;iBACjB;aACF,CAAC;YAEF,MAAM,CAAC,GAAG,EAAE,CACV,IAAA,+CAA0B,EAAC,WAAW,EAAE,yBAAyB,CAAC,CACnE,CAAC,OAAO,CAAC,sDAAsD,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oDAAoD,EAAE,GAAG,EAAE;YAC5D,MAAM,uBAAuB,GAAsB;gBACjD,aAAa,EAAE;oBACb,IAAI,EAAE,eAAe;oBACrB,WAAW,EAAE,kBAAkB;oBAC/B,SAAS,EAAE,aAAa;oBACxB,KAAK,EAAE;wBACL,WAAW,EAAE;4BACX,OAAO,EAAE,CAAC;4BACV,MAAM,EAAE,MAAM;4BACd,QAAQ,EAAE,KAAK,IAAI,EAAE,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;yBAC3D;qBACF;oBACD,YAAY,EAAE,EAAE;iBACjB;aACF,CAAC;YAEF,MAAM,CAAC,GAAG,EAAE,CACV,IAAA,+CAA0B,EAAC,WAAW,EAAE,uBAAuB,CAAC,CACjE,CAAC,OAAO,CAAC,8DAA8D,CAAC,CAAC;QAC5E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gEAAgE,EAAE,GAAG,EAAE;YACxE,MAAM,kBAAkB,GAAsB;gBAC5C,aAAa,EAAE;oBACb,IAAI,EAAE,eAAe;oBACrB,WAAW,EAAE,kBAAkB;oBAC/B,SAAS,EAAE,aAAa;oBACxB,KAAK,EAAE;wBACL,IAAI,EAAE,QAAQ;wBACd,UAAU,EAAE;4BACV,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;yBAC1B;qBACF;oBACD,YAAY,EAAE,EAAE;iBACjB;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,WAAW,EACX,kBAAkB,CACnB,CAAC;YAEF,yCAAyC;YACzC,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC;QAC9D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,uCAAuC,EAAE,GAAG,EAAE;YAC/C,MAAM,MAAM,GAAG,IAAA,+CAA0B,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;YAErE,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACtC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC;gBAC7B,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,wBAAwB,EAAE;aACjD,CAAC,CAAC;YACH,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;QACxD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sCAAsC,EAAE,GAAG,EAAE;YAC9C,MAAM,MAAM,GAAG,IAAA,+CAA0B,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;YAErE,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,WAAW,EAAE,CAAC;YAC/C,MAAM,CAAC,eAAK,CAAC,cAAc,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2CAA2C,EAAE,GAAG,EAAE;YACnD,IAAA,+CAA0B,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;YAEtD,MAAM,CAAC,+BAA+B,CAAC,CAAC,gBAAgB,EAAE,CAAC;YAC3D,yEAAyE;YACzE,MAAM,QAAQ,GAAG,+BAA+B,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC/D,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,YAAY,EAAE,GAAG,EAAE;QAC1B,EAAE,CAAC,qCAAqC,EAAE,GAAG,EAAE;YAC7C,MAAM,uBAAuB,GAAG;gBAC9B,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,qCAAqC,EAAE;oBACvD,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,uBAAuB,EACvB,YAAY,CACb,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CACxC,qCAAqC,CACtC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0BAA0B,EAAE,GAAG,EAAE;YAClC,MAAM,kBAAkB,GAAG;gBACzB,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,oBAAoB,EAAE,EAAE,aAAa;oBACrD,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,kBAAkB,EAClB,YAAY,CACb,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;QACnE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,GAAG,EAAE;YACtC,MAAM,mBAAmB,GAAG;gBAC1B,GAAG,WAAW;gBACd,SAAS,EAAE;oBACT,aAAa,EAAE,eAAe;oBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE;oBACzC,cAAc,EAAE,EAAE;oBAClB,OAAO,EAAE,EAAE;iBACZ;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,IAAA,+CAA0B,EACvC,mBAAmB,EACnB,YAAY,CACb,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC;gBACtC,KAAK,EAAE,MAAM;gBACb,SAAS,EAAE,IAAI;aAChB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import TamboAI from \"@tambo-ai/typescript-sdk\";\nimport React from \"react\";\nimport { ComponentRegistry } from \"../model/component-metadata\";\nimport * as useCurrentMessage from \"../hooks/use-current-message\";\nimport { renderComponentIntoMessage } from \"./generate-component\";\n\n// Track calls to wrapWithTamboMessageProvider\nlet wrapWithTamboMessageProviderSpy: jest.SpyInstance;\n\nbeforeEach(() => {\n  wrapWithTamboMessageProviderSpy = jest.spyOn(\n    useCurrentMessage,\n    \"wrapWithTamboMessageProvider\",\n  );\n});\n\nafterEach(() => {\n  wrapWithTamboMessageProviderSpy.mockRestore();\n});\n\n// Simple test component\nconst TestComponent: React.FC<{ title: string; count?: number }> = ({\n  title,\n  count,\n}) => (\n  <div data-testid=\"test-component\">\n    <span>{title}</span>\n    {count !== undefined && <span>{count}</span>}\n  </div>\n);\n\n// Create a mock Standard Schema for testing\nconst createMockStandardSchema = (validate: (data: unknown) => unknown) => ({\n  \"~standard\": {\n    version: 1,\n    vendor: \"test\",\n    validate: (data: unknown) => ({ value: validate(data) }),\n  },\n});\n\ndescribe(\"renderComponentIntoMessage\", () => {\n  const baseMessage = {\n    id: \"msg-123\",\n    threadId: \"thread-456\",\n    role: \"assistant\",\n    content: [{ type: \"text\", text: \"Here is your component\" }],\n    createdAt: \"2024-01-01T00:00:00Z\",\n    componentState: {},\n    component: {\n      componentName: \"TestComponent\",\n      props: { title: \"Hello\" },\n      componentState: {},\n      message: \"\",\n    },\n  } as unknown as TamboAI.Beta.Threads.ThreadMessage;\n\n  const baseRegistry: ComponentRegistry = {\n    TestComponent: {\n      name: \"TestComponent\",\n      description: \"A test component\",\n      component: TestComponent,\n      props: { type: \"object\" }, // JSON Schema\n      contextTools: [],\n    },\n  };\n\n  describe(\"component lookup\", () => {\n    it(\"throws error when component has no componentName\", () => {\n      const messageWithoutComponentName = {\n        ...baseMessage,\n        component: {\n          componentName: \"\",\n          props: {},\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      expect(() =>\n        renderComponentIntoMessage(messageWithoutComponentName, baseRegistry),\n      ).toThrow(\"Component not found\");\n    });\n\n    it(\"throws error when component is null\", () => {\n      const messageWithNullComponent = {\n        ...baseMessage,\n        component: null as any,\n      };\n\n      expect(() =>\n        renderComponentIntoMessage(messageWithNullComponent, baseRegistry),\n      ).toThrow();\n    });\n\n    it(\"throws error when componentName not in registry\", () => {\n      const messageWithUnknownComponent = {\n        ...baseMessage,\n        component: {\n          componentName: \"UnknownComponent\",\n          props: {},\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      expect(() =>\n        renderComponentIntoMessage(messageWithUnknownComponent, baseRegistry),\n      ).toThrow(\n        \"Tambo tried to use Component UnknownComponent, but it was not found\",\n      );\n    });\n\n    it(\"successfully finds and renders registered component\", () => {\n      const result = renderComponentIntoMessage(baseMessage, baseRegistry);\n\n      expect(result.component?.componentName).toBe(\"TestComponent\");\n      expect(result.renderedComponent).toBeDefined();\n    });\n  });\n\n  describe(\"props handling\", () => {\n    it(\"passes props to component from message\", () => {\n      const messageWithProps = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: { title: \"Test Title\", count: 42 },\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(messageWithProps, baseRegistry);\n\n      expect(result.component?.props).toEqual({\n        title: \"Test Title\",\n        count: 42,\n      });\n    });\n\n    it(\"handles empty props object\", () => {\n      const messageWithEmptyProps = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: {},\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        messageWithEmptyProps,\n        baseRegistry,\n      );\n\n      expect(result.component?.props).toEqual({});\n    });\n\n    it(\"handles nested object props\", () => {\n      const messageWithNestedProps = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: {\n            title: \"Nested\",\n            config: { nested: { deeply: { value: 123 } } },\n          },\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        messageWithNestedProps,\n        baseRegistry,\n      );\n\n      expect(result.component?.props).toEqual({\n        title: \"Nested\",\n        config: { nested: { deeply: { value: 123 } } },\n      });\n    });\n\n    it(\"handles array props\", () => {\n      const messageWithArrayProps = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: { title: \"Array Test\", items: [1, 2, 3] },\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        messageWithArrayProps,\n        baseRegistry,\n      );\n\n      expect(result.component?.props).toEqual({\n        title: \"Array Test\",\n        items: [1, 2, 3],\n      });\n    });\n  });\n\n  describe(\"Standard Schema validation\", () => {\n    it(\"validates props through Standard Schema when present\", () => {\n      const mockValidate = jest.fn((data) => ({\n        ...data,\n        validated: true,\n      }));\n\n      const registryWithStandardSchema: ComponentRegistry = {\n        TestComponent: {\n          name: \"TestComponent\",\n          description: \"A test component\",\n          component: TestComponent,\n          props: createMockStandardSchema(mockValidate),\n          contextTools: [],\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        baseMessage,\n        registryWithStandardSchema,\n      );\n\n      expect(mockValidate).toHaveBeenCalled();\n      // Standard Schema validate returns { value: T }, we extract the value\n      expect(result.component?.props).toEqual({\n        title: \"Hello\",\n        validated: true,\n      });\n    });\n\n    it(\"throws error when validation returns issues\", () => {\n      const registryWithFailingSchema: ComponentRegistry = {\n        TestComponent: {\n          name: \"TestComponent\",\n          description: \"A test component\",\n          component: TestComponent,\n          props: {\n            \"~standard\": {\n              version: 1,\n              vendor: \"test\",\n              validate: () => ({\n                issues: [{ message: \"title is required\", path: [\"title\"] }],\n              }),\n            },\n          },\n          contextTools: [],\n        },\n      };\n\n      expect(() =>\n        renderComponentIntoMessage(baseMessage, registryWithFailingSchema),\n      ).toThrow(\"Component props validation failed: title is required\");\n    });\n\n    it(\"throws error when validation returns async promise\", () => {\n      const registryWithAsyncSchema: ComponentRegistry = {\n        TestComponent: {\n          name: \"TestComponent\",\n          description: \"A test component\",\n          component: TestComponent,\n          props: {\n            \"~standard\": {\n              version: 1,\n              vendor: \"test\",\n              validate: async () => await Promise.resolve({ value: {} }),\n            },\n          },\n          contextTools: [],\n        },\n      };\n\n      expect(() =>\n        renderComponentIntoMessage(baseMessage, registryWithAsyncSchema),\n      ).toThrow(\"Async schema validation is not supported for component props\");\n    });\n\n    it(\"uses raw props when props is JSON Schema (not Standard Schema)\", () => {\n      const jsonSchemaRegistry: ComponentRegistry = {\n        TestComponent: {\n          name: \"TestComponent\",\n          description: \"A test component\",\n          component: TestComponent,\n          props: {\n            type: \"object\",\n            properties: {\n              title: { type: \"string\" },\n            },\n          },\n          contextTools: [],\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        baseMessage,\n        jsonSchemaRegistry,\n      );\n\n      // Should pass through without validation\n      expect(result.component?.props).toEqual({ title: \"Hello\" });\n    });\n  });\n\n  describe(\"message structure\", () => {\n    it(\"preserves original message properties\", () => {\n      const result = renderComponentIntoMessage(baseMessage, baseRegistry);\n\n      expect(result.id).toBe(\"msg-123\");\n      expect(result.threadId).toBe(\"thread-456\");\n      expect(result.role).toBe(\"assistant\");\n      expect(result.content).toEqual([\n        { type: \"text\", text: \"Here is your component\" },\n      ]);\n      expect(result.createdAt).toBe(\"2024-01-01T00:00:00Z\");\n    });\n\n    it(\"includes renderedComponent in result\", () => {\n      const result = renderComponentIntoMessage(baseMessage, baseRegistry);\n\n      expect(result.renderedComponent).toBeDefined();\n      expect(React.isValidElement(result.renderedComponent)).toBe(true);\n    });\n\n    it(\"wraps component with TamboMessageProvider\", () => {\n      renderComponentIntoMessage(baseMessage, baseRegistry);\n\n      expect(wrapWithTamboMessageProviderSpy).toHaveBeenCalled();\n      // Check that the message passed to the wrapper has the correct structure\n      const callArgs = wrapWithTamboMessageProviderSpy.mock.calls[0];\n      expect(callArgs[1].id).toBe(\"msg-123\");\n    });\n  });\n\n  describe(\"edge cases\", () => {\n    it(\"handles special characters in props\", () => {\n      const messageWithSpecialChars = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: { title: \"Hello <script>alert('xss')</script>\" },\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        messageWithSpecialChars,\n        baseRegistry,\n      );\n\n      expect(result.component?.props.title).toBe(\n        \"Hello <script>alert('xss')</script>\",\n      );\n    });\n\n    it(\"handles unicode in props\", () => {\n      const messageWithUnicode = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: { title: \"Hello \\u4e16\\u754c\" }, // \"Hello 世界\"\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        messageWithUnicode,\n        baseRegistry,\n      );\n\n      expect(result.component?.props.title).toBe(\"Hello \\u4e16\\u754c\");\n    });\n\n    it(\"handles null values in props\", () => {\n      const messageWithNullProp = {\n        ...baseMessage,\n        component: {\n          componentName: \"TestComponent\",\n          props: { title: \"Test\", nullValue: null },\n          componentState: {},\n          message: \"\",\n        },\n      };\n\n      const result = renderComponentIntoMessage(\n        messageWithNullProp,\n        baseRegistry,\n      );\n\n      expect(result.component?.props).toEqual({\n        title: \"Test\",\n        nullValue: null,\n      });\n    });\n  });\n});\n"]}
{"version":3,"file":"registry-conversion.test.js","sourceRoot":"","sources":["../../../src/v1/utils/registry-conversion.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\nimport type { TamboComponent, TamboTool } from \"../../model/component-metadata\";\nimport {\n  toAvailableComponent,\n  toAvailableComponents,\n  toAvailableTool,\n  toAvailableTools,\n} from \"./registry-conversion\";\n\ndescribe(\"registry-conversion\", () => {\n  describe(\"toAvailableComponent\", () => {\n    it(\"converts a component with propsSchema\", () => {\n      const component: TamboComponent = {\n        name: \"WeatherCard\",\n        description: \"Displays weather information\",\n        component: () => null,\n        propsSchema: z.object({\n          city: z.string(),\n          temperature: z.number(),\n        }),\n      };\n\n      const result = toAvailableComponent(component);\n\n      expect(result.name).toBe(\"WeatherCard\");\n      expect(result.description).toBe(\"Displays weather information\");\n      expect(result.propsSchema).toBeDefined();\n      expect((result.propsSchema as Record<string, unknown>).type).toBe(\n        \"object\",\n      );\n    });\n\n    it(\"throws when propsSchema is missing\", () => {\n      const component = {\n        name: \"BadComponent\",\n        description: \"Missing schema\",\n        component: () => null,\n      } as TamboComponent;\n\n      expect(() => toAvailableComponent(component)).toThrow(\n        'Component \"BadComponent\" missing propsSchema',\n      );\n    });\n  });\n\n  describe(\"toAvailableComponents\", () => {\n    it(\"converts a Record of components\", () => {\n      const components: Record<string, TamboComponent> = {\n        Card: {\n          name: \"Card\",\n          description: \"A card component\",\n          component: () => null,\n          propsSchema: z.object({ title: z.string() }),\n        },\n        Button: {\n          name: \"Button\",\n          description: \"A button component\",\n          component: () => null,\n          propsSchema: z.object({ label: z.string() }),\n        },\n      };\n\n      const result = toAvailableComponents(components);\n\n      expect(result).toHaveLength(2);\n      expect(result.map((c) => c.name)).toContain(\"Card\");\n      expect(result.map((c) => c.name)).toContain(\"Button\");\n    });\n\n    it(\"converts a Map of components\", () => {\n      const components = new Map<string, TamboComponent>([\n        [\n          \"Card\",\n          {\n            name: \"Card\",\n            description: \"A card\",\n            component: () => null,\n            propsSchema: z.object({ title: z.string() }),\n          },\n        ],\n      ]);\n\n      const result = toAvailableComponents(components);\n\n      expect(result).toHaveLength(1);\n      expect(result[0].name).toBe(\"Card\");\n    });\n\n    it(\"skips invalid components and logs warning\", () => {\n      const warnSpy = jest.spyOn(console, \"warn\").mockImplementation(() => {});\n\n      const components: Record<string, TamboComponent> = {\n        Valid: {\n          name: \"Valid\",\n          description: \"Valid component\",\n          component: () => null,\n          propsSchema: z.object({ x: z.string() }),\n        },\n        Invalid: {\n          name: \"Invalid\",\n          description: \"Missing schema\",\n          component: () => null,\n        } as TamboComponent,\n      };\n\n      const result = toAvailableComponents(components);\n\n      expect(result).toHaveLength(1);\n      expect(result[0].name).toBe(\"Valid\");\n      expect(warnSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Skipping component \"Invalid\"'),\n      );\n\n      warnSpy.mockRestore();\n    });\n  });\n\n  describe(\"toAvailableTool\", () => {\n    it(\"converts a tool with inputSchema\", () => {\n      const tool: TamboTool = {\n        name: \"get_weather\",\n        description: \"Gets weather for a city\",\n        tool: async () => ({ temp: 72 }),\n        inputSchema: z.object({ city: z.string() }),\n        outputSchema: z.any(),\n      };\n\n      const result = toAvailableTool(tool);\n\n      expect(result.name).toBe(\"get_weather\");\n      expect(result.description).toBe(\"Gets weather for a city\");\n      expect(result.inputSchema).toBeDefined();\n      expect((result.inputSchema as Record<string, unknown>).type).toBe(\n        \"object\",\n      );\n    });\n\n    it(\"throws when schema is missing\", () => {\n      const tool = {\n        name: \"bad_tool\",\n        description: \"Missing schema\",\n        tool: async () => ({}),\n      } as unknown as TamboTool;\n\n      expect(() => toAvailableTool(tool)).toThrow(\n        'Tool \"bad_tool\" missing inputSchema or toolSchema',\n      );\n    });\n  });\n\n  describe(\"toAvailableTools\", () => {\n    it(\"converts a Record of tools\", () => {\n      const tools: Record<string, TamboTool> = {\n        search: {\n          name: \"search\",\n          description: \"Search the web\",\n          tool: async () => [],\n          inputSchema: z.object({ query: z.string() }),\n          outputSchema: z.any(),\n        },\n        calculate: {\n          name: \"calculate\",\n          description: \"Calculate expression\",\n          tool: async () => 0,\n          inputSchema: z.object({ expr: z.string() }),\n          outputSchema: z.any(),\n        },\n      };\n\n      const result = toAvailableTools(tools);\n\n      expect(result).toHaveLength(2);\n      expect(result.map((t) => t.name)).toContain(\"search\");\n      expect(result.map((t) => t.name)).toContain(\"calculate\");\n    });\n\n    it(\"converts a Map of tools\", () => {\n      const tools = new Map<string, TamboTool>([\n        [\n          \"fetch\",\n          {\n            name: \"fetch\",\n            description: \"Fetch data\",\n            tool: async () => null,\n            inputSchema: z.object({ url: z.string() }),\n            outputSchema: z.any(),\n          },\n        ],\n      ]);\n\n      const result = toAvailableTools(tools);\n\n      expect(result).toHaveLength(1);\n      expect(result[0].name).toBe(\"fetch\");\n    });\n\n    it(\"skips invalid tools and logs warning\", () => {\n      const warnSpy = jest.spyOn(console, \"warn\").mockImplementation(() => {});\n\n      const tools: Record<string, TamboTool> = {\n        valid: {\n          name: \"valid\",\n          description: \"Valid tool\",\n          tool: async () => null,\n          inputSchema: z.object({ x: z.number() }),\n          outputSchema: z.any(),\n        },\n        invalid: {\n          name: \"invalid\",\n          description: \"Missing schema\",\n          tool: async () => null,\n        } as unknown as TamboTool,\n      };\n\n      const result = toAvailableTools(tools);\n\n      expect(result).toHaveLength(1);\n      expect(result[0].name).toBe(\"valid\");\n      expect(warnSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Skipping tool \"invalid\"'),\n      );\n\n      warnSpy.mockRestore();\n    });\n  });\n});\n"]}
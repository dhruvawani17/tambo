{"version":3,"file":"tambo-v1-provider.js","sourceRoot":"","sources":["../../../src/v1/providers/tambo-v1-provider.tsx"],"names":[],"mappings":";AAAA,YAAY,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4Db,4CAMC;AA+HD,0CAkEC;AAjQD;;;;;;;;;;;GAWG;AAEH,+CAKe;AACf,uDAAyE;AACzE,iFAG+C;AAC/C,qFAGiD;AACjD,mGAA6F;AAO7F,uEAAkE;AAClE,qFAA8E;AAW9E;;;GAGG;AACU,QAAA,oBAAoB,GAAG,IAAA,qBAAa,EAAuB,IAAI,CAAC,CAAC;AAE9E;;;;GAIG;AACH,SAAgB,gBAAgB;IAC9B,MAAM,MAAM,GAAG,IAAA,kBAAU,EAAC,4BAAoB,CAAC,CAAC;IAChD,IAAI,CAAC,MAAM,EAAE,CAAC;QACZ,MAAM,IAAI,KAAK,CAAC,sDAAsD,CAAC,CAAC;IAC1E,CAAC;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AAmFD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA2CG;AACH,SAAgB,eAAe,CAAC,EAC9B,MAAM,EACN,QAAQ,EACR,WAAW,EACX,SAAS,EACT,UAAU,EACV,KAAK,EACL,UAAU,EACV,sBAAsB,EACtB,SAAS,EACT,aAAa,EACb,WAAW,EACX,cAAc,EACd,OAAO,EACP,WAAW,EACX,QAAQ,GACgC;IACxC,wDAAwD;IACxD,mEAAmE;IACnE,MAAM,CAAC,kBAAkB,CAAC,GAAG,IAAA,gBAAQ,EACnC,GAAG,EAAE,CACH,IAAI,yBAAW,CAAC;QACd,cAAc,EAAE;YACd,OAAO,EAAE;gBACP,SAAS,EAAE,IAAI;gBACf,KAAK,EAAE,CAAC;aACT;SACF;KACF,CAAC,CACL,CAAC;IAEF,MAAM,MAAM,GAAG,WAAW,IAAI,kBAAkB,CAAC;IAEjD,oDAAoD;IACpD,MAAM,MAAM,GAAkB,EAAE,OAAO,EAAE,CAAC;IAE1C,OAAO,CACL,8BAAC,iCAAmB,IAAC,MAAM,EAAE,MAAM;QACjC,8BAAC,2CAAmB,IAClB,MAAM,EAAE,MAAM,EACd,QAAQ,EAAE,QAAQ,EAClB,WAAW,EAAE,WAAW,EACxB,SAAS,EAAE,SAAS;YAEpB,8BAAC,+CAAqB,IACpB,UAAU,EAAE,UAAU,EACtB,KAAK,EAAE,KAAK,EACZ,UAAU,EAAE,UAAU,EACtB,sBAAsB,EAAE,sBAAsB,EAC9C,SAAS,EAAE,SAAS,EACpB,aAAa,EAAE,aAAa,EAC5B,WAAW,EAAE,WAAW;gBAExB,8BAAC,4DAA2B,IAAC,cAAc,EAAE,cAAc;oBACzD,8BAAC,4BAAoB,CAAC,QAAQ,IAAC,KAAK,EAAE,MAAM;wBAC1C,8BAAC,+CAAqB;4BACpB,8BAAC,2DAA0B,QACxB,QAAQ,CACkB,CACP,CACM,CACJ,CACR,CACJ,CACF,CACvB,CAAC;AACJ,CAAC","sourcesContent":["\"use client\";\n\n/**\n * TamboV1Provider - Main Provider for v1 API\n *\n * Composes the necessary providers for the v1 SDK:\n * - TamboClientProvider: API client and authentication\n * - TamboRegistryProvider: Component and tool registration\n * - TamboContextHelpersProvider: Context helper functions\n * - TamboV1StreamProvider: Streaming state management\n *\n * This provider should wrap your entire application or the portion\n * that needs access to Tambo v1 functionality.\n */\n\nimport React, {\n  createContext,\n  useContext,\n  type PropsWithChildren,\n  useState,\n} from \"react\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport {\n  TamboClientProvider,\n  type TamboClientProviderProps,\n} from \"../../providers/tambo-client-provider\";\nimport {\n  TamboRegistryProvider,\n  type TamboRegistryProviderProps,\n} from \"../../providers/tambo-registry-provider\";\nimport { TamboContextHelpersProvider } from \"../../providers/tambo-context-helpers-provider\";\nimport type { ContextHelpers } from \"../../context-helpers\";\nimport type { McpServerInfo } from \"../../model/mcp-server-info\";\nimport type {\n  ListResourceItem,\n  ResourceSource,\n} from \"../../model/resource-info\";\nimport { TamboV1StreamProvider } from \"./tambo-v1-stream-context\";\nimport { TamboV1ThreadInputProvider } from \"./tambo-v1-thread-input-provider\";\n\n/**\n * Configuration values for v1 SDK.\n * These are static values that don't change during the session.\n */\nexport interface TamboV1Config {\n  /** User key for thread ownership and scoping */\n  userKey?: string;\n}\n\n/**\n * Context for v1 SDK configuration.\n * @internal\n */\nexport const TamboV1ConfigContext = createContext<TamboV1Config | null>(null);\n\n/**\n * Hook to access v1 SDK configuration.\n * @returns Configuration values including userKey\n * @throws {Error} If used outside TamboV1Provider\n */\nexport function useTamboV1Config(): TamboV1Config {\n  const config = useContext(TamboV1ConfigContext);\n  if (!config) {\n    throw new Error(\"useTamboV1Config must be used within TamboV1Provider\");\n  }\n  return config;\n}\n\n/**\n * Props for TamboV1Provider\n */\nexport interface TamboV1ProviderProps extends Pick<\n  TamboClientProviderProps,\n  \"apiKey\" | \"tamboUrl\" | \"environment\" | \"userToken\"\n> {\n  /**\n   * Components to register with the registry.\n   * These will be available for the AI to use in responses.\n   */\n  components?: TamboRegistryProviderProps[\"components\"];\n\n  /**\n   * Tools to register with the registry.\n   * These will be executed client-side when requested by the AI.\n   */\n  tools?: TamboRegistryProviderProps[\"tools\"];\n\n  /**\n   * MCP servers to register with the registry.\n   * These provide additional tools and resources from MCP-compatible servers.\n   */\n  mcpServers?: (McpServerInfo | string)[];\n\n  /**\n   * Callback function called when an unregistered tool is called.\n   * If not provided, an error will be thrown for unknown tools.\n   */\n  onCallUnregisteredTool?: TamboRegistryProviderProps[\"onCallUnregisteredTool\"];\n\n  /**\n   * Static resources to register with the registry.\n   * These will be available for the AI to access.\n   */\n  resources?: ListResourceItem[];\n\n  /**\n   * Dynamic resource search function.\n   * Must be paired with getResource.\n   * Called when searching for resources dynamically.\n   */\n  listResources?: ResourceSource[\"listResources\"];\n\n  /**\n   * Dynamic resource fetch function.\n   * Must be paired with listResources.\n   * Called when fetching a specific resource by URI.\n   */\n  getResource?: ResourceSource[\"getResource\"];\n\n  /**\n   * Configuration for context helpers.\n   * A dictionary of functions that provide additional context to the AI.\n   * Each key becomes the context name, and the function returns the value.\n   */\n  contextHelpers?: ContextHelpers;\n\n  /**\n   * User key for thread ownership and scoping.\n   *\n   * **Required**: You must provide either `userKey` OR `userToken` (which contains a userKey).\n   * All thread operations (create, list, fetch) only return threads owned by this userKey.\n   *\n   * - Use `userKey` for server-side or trusted environments where you control the user identity\n   * - Use `userToken` (OAuth bearer token) for client-side apps where the token contains the userKey\n   */\n  userKey?: string;\n\n  /**\n   * Optional custom QueryClient instance.\n   * If not provided, a default client will be created.\n   */\n  queryClient?: QueryClient;\n\n  /**\n   * Children components\n   */\n  children: React.ReactNode;\n}\n\n/**\n * Main provider for the Tambo v1 SDK.\n *\n * Composes TamboClientProvider, TamboRegistryProvider, and TamboV1StreamProvider\n * to provide a complete context for building AI-powered applications.\n *\n * Threads are managed dynamically through useTamboV1() hook functions:\n * - startNewThread() - Begin a new conversation\n * - switchThread(threadId) - Switch to an existing thread\n * - initThread(threadId) - Initialize a thread for receiving events\n * @param props - Provider configuration\n * @param props.apiKey - Tambo API key for authentication\n * @param props.tamboUrl - Optional custom Tambo API URL\n * @param props.environment - Optional environment configuration\n * @param props.userToken - Optional OAuth token for user authentication\n * @param props.components - Components to register with the AI\n * @param props.tools - Tools to register for client-side execution\n * @param props.mcpServers - MCP servers to register for additional tools/resources\n * @param props.onCallUnregisteredTool - Callback for handling unknown tool calls\n * @param props.resources - Static resources to register with the AI\n * @param props.listResources - Dynamic resource search function (must be paired with getResource)\n * @param props.getResource - Dynamic resource fetch function (must be paired with listResources)\n * @param props.contextHelpers - Configuration for context helper functions\n * @param props.userKey - User key for thread ownership (required if not using userToken)\n * @param props.queryClient - Optional custom React Query client\n * @param props.children - Child components\n * @returns Provider component tree\n * @example\n * ```tsx\n * import { TamboV1Provider } from '@tambo-ai/react/v1';\n *\n * function App() {\n *   return (\n *     <TamboV1Provider\n *       apiKey={process.env.NEXT_PUBLIC_TAMBO_API_KEY!}\n *       components={[WeatherCard, StockChart]}\n *       tools={[searchTool, calculatorTool]}\n *     >\n *       <ChatInterface />\n *     </TamboV1Provider>\n *   );\n * }\n * ```\n */\nexport function TamboV1Provider({\n  apiKey,\n  tamboUrl,\n  environment,\n  userToken,\n  components,\n  tools,\n  mcpServers,\n  onCallUnregisteredTool,\n  resources,\n  listResources,\n  getResource,\n  contextHelpers,\n  userKey,\n  queryClient,\n  children,\n}: PropsWithChildren<TamboV1ProviderProps>) {\n  // Create a stable default QueryClient if none provided.\n  // Using useState to avoid SSR issues with module-level singletons.\n  const [defaultQueryClient] = useState(\n    () =>\n      new QueryClient({\n        defaultOptions: {\n          queries: {\n            staleTime: 1000,\n            retry: 1,\n          },\n        },\n      }),\n  );\n\n  const client = queryClient ?? defaultQueryClient;\n\n  // Config is static - created once and never changes\n  const config: TamboV1Config = { userKey };\n\n  return (\n    <QueryClientProvider client={client}>\n      <TamboClientProvider\n        apiKey={apiKey}\n        tamboUrl={tamboUrl}\n        environment={environment}\n        userToken={userToken}\n      >\n        <TamboRegistryProvider\n          components={components}\n          tools={tools}\n          mcpServers={mcpServers}\n          onCallUnregisteredTool={onCallUnregisteredTool}\n          resources={resources}\n          listResources={listResources}\n          getResource={getResource}\n        >\n          <TamboContextHelpersProvider contextHelpers={contextHelpers}>\n            <TamboV1ConfigContext.Provider value={config}>\n              <TamboV1StreamProvider>\n                <TamboV1ThreadInputProvider>\n                  {children}\n                </TamboV1ThreadInputProvider>\n              </TamboV1StreamProvider>\n            </TamboV1ConfigContext.Provider>\n          </TamboContextHelpersProvider>\n        </TamboRegistryProvider>\n      </TamboClientProvider>\n    </QueryClientProvider>\n  );\n}\n"]}
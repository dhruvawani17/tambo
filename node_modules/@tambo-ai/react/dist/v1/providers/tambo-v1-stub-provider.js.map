{"version":3,"file":"tambo-v1-stub-provider.js","sourceRoot":"","sources":["../../../src/v1/providers/tambo-v1-stub-provider.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\";\n\n/**\n * TamboV1StubProvider - Mock Provider for Testing\n *\n * Provides stubbed versions of all v1 contexts for testing components\n * that use Tambo hooks without making real API calls.\n * @example\n * ```tsx\n * const mockThread = {\n *   id: \"thread_123\",\n *   messages: [\n *     { id: \"msg_1\", role: \"user\", content: [{ type: \"text\", text: \"Hello\" }], createdAt: \"...\" },\n *     { id: \"msg_2\", role: \"assistant\", content: [{ type: \"text\", text: \"Hi!\" }], createdAt: \"...\" },\n *   ],\n *   status: \"idle\",\n *   createdAt: \"2024-01-01T00:00:00Z\",\n *   updatedAt: \"2024-01-01T00:00:00Z\",\n * };\n *\n * function TestComponent() {\n *   return (\n *     <TamboV1StubProvider thread={mockThread}>\n *       <MyComponent />\n *     </TamboV1StubProvider>\n *   );\n * }\n * ```\n */\n\nimport TamboAI from \"@tambo-ai/typescript-sdk\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport React, { useMemo, type PropsWithChildren } from \"react\";\nimport type {\n  TamboComponent,\n  TamboTool,\n  TamboToolRegistry,\n} from \"../../model/component-metadata\";\nimport { TamboClientContext } from \"../../providers/tambo-client-provider\";\nimport { TamboRegistryContext } from \"../../providers/tambo-registry-provider\";\nimport type { TamboV1Message } from \"../types/message\";\nimport type { TamboV1Thread } from \"../types/thread\";\nimport type {\n  StreamAction,\n  StreamState,\n  ThreadState,\n} from \"../utils/event-accumulator\";\nimport { TamboV1ConfigContext, type TamboV1Config } from \"./tambo-v1-provider\";\nimport {\n  TamboV1StreamProvider,\n  type ThreadManagement,\n} from \"./tambo-v1-stream-context\";\nimport {\n  TamboV1ThreadInputContext,\n  type TamboV1ThreadInputContextProps,\n} from \"./tambo-v1-thread-input-provider\";\n\n/**\n * Props for TamboV1StubProvider\n */\nexport interface TamboV1StubProviderProps {\n  /**\n   * Thread data to display.\n   * Can be a full TamboV1Thread or just an array of messages.\n   */\n  thread?: TamboV1Thread | { messages: TamboV1Message[] };\n\n  /**\n   * Optional thread ID. Defaults to \"stub_thread\" or thread.id if provided.\n   */\n  threadId?: string;\n\n  /**\n   * Components to register with the registry.\n   */\n  components?: TamboComponent[];\n\n  /**\n   * Tools to register with the registry.\n   */\n  tools?: TamboTool[];\n\n  /**\n   * User key for the config context.\n   */\n  userKey?: string;\n\n  /**\n   * Initial input value for the thread input context.\n   */\n  inputValue?: string;\n\n  /**\n   * Whether the thread is currently streaming.\n   */\n  isStreaming?: boolean;\n\n  /**\n   * Override for the submit function.\n   * If not provided, submit will be a no-op that returns the threadId.\n   */\n  onSubmit?: () => Promise<{ threadId: string }>;\n\n  /**\n   * Override for the setValue function.\n   */\n  onSetValue?: (value: string | ((prev: string) => string)) => void;\n\n  /**\n   * Override for startNewThread.\n   */\n  onStartNewThread?: () => string;\n\n  /**\n   * Override for switchThread.\n   */\n  onSwitchThread?: (threadId: string | null) => void;\n\n  /**\n   * Override for initThread.\n   */\n  onInitThread?: (threadId: string) => void;\n}\n\n/**\n * Creates a default TamboV1Thread from messages or returns the full thread.\n * @returns A normalized thread object\n */\nfunction normalizeThread(\n  threadData: TamboV1Thread | { messages: TamboV1Message[] } | undefined,\n  threadId: string,\n): TamboV1Thread {\n  if (!threadData) {\n    return {\n      id: threadId,\n      messages: [],\n      status: \"idle\",\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n    };\n  }\n\n  if (\"id\" in threadData && \"status\" in threadData) {\n    return threadData;\n  }\n\n  return {\n    id: threadId,\n    messages: threadData.messages,\n    status: \"idle\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  };\n}\n\n/**\n * TamboV1StubProvider provides mock implementations of all v1 contexts\n * for testing components that use Tambo hooks.\n *\n * All operations are no-ops by default, returning stub data.\n * Override specific behaviors via props as needed for testing.\n * Stream state is derived once from props and is not updated by thread management.\n * @returns A provider wrapper suitable for tests\n */\nexport function TamboV1StubProvider({\n  children,\n  thread: threadData,\n  threadId: providedThreadId,\n  components = [],\n  tools = [],\n  userKey,\n  inputValue: initialInputValue = \"\",\n  isStreaming = false,\n  onSubmit,\n  onSetValue,\n  onStartNewThread,\n  onSwitchThread,\n  onInitThread,\n}: PropsWithChildren<TamboV1StubProviderProps>) {\n  // Determine thread ID\n  const threadId =\n    providedThreadId ??\n    (threadData && \"id\" in threadData ? threadData.id : \"stub_thread\");\n\n  // Normalize thread data\n  const thread = normalizeThread(threadData, threadId);\n\n  // Create stub QueryClient\n  const queryClient = useMemo(\n    () =>\n      new QueryClient({\n        defaultOptions: {\n          queries: { retry: false },\n          mutations: { retry: false },\n        },\n      }),\n    [],\n  );\n\n  // Create stub client\n  const stubClient = useMemo(() => ({}) as TamboAI, []);\n\n  // Build component registry\n  const componentList = useMemo(() => {\n    const list: TamboRegistryContext[\"componentList\"] = {};\n\n    for (const component of components) {\n      list[component.name] = {\n        component: component.component,\n        loadingComponent: component.loadingComponent,\n        name: component.name,\n        description: component.description,\n        props: component.propsDefinition ?? {},\n        contextTools: [],\n      };\n    }\n\n    return list;\n  }, [components]);\n\n  // Build tool registry\n  const toolRegistry = useMemo(() => {\n    return tools.reduce((acc, tool) => {\n      acc[tool.name] = tool;\n      return acc;\n    }, {} as TamboToolRegistry);\n  }, [tools]);\n\n  // Stream state\n  const streamState = useMemo<StreamState>(() => {\n    const threadState: ThreadState = {\n      thread,\n      streaming: {\n        status: isStreaming ? \"streaming\" : \"idle\",\n      },\n      accumulatingToolArgs: new Map(),\n    };\n\n    return {\n      threadMap: { [threadId]: threadState },\n      currentThreadId: threadId,\n    };\n  }, [thread, threadId, isStreaming]);\n\n  // Stream dispatch (no-op)\n  const streamDispatch = useMemo<React.Dispatch<StreamAction>>(\n    () => () => {},\n    [],\n  );\n\n  // Thread management\n  const threadManagement = useMemo<ThreadManagement>(\n    () => ({\n      initThread: onInitThread ?? (() => {}),\n      switchThread: onSwitchThread ?? (() => {}),\n      startNewThread:\n        onStartNewThread ??\n        (() => {\n          const newId = `stub_${crypto.randomUUID()}`;\n          return newId;\n        }),\n    }),\n    [onInitThread, onSwitchThread, onStartNewThread],\n  );\n\n  // Config context\n  const config = useMemo<TamboV1Config>(() => ({ userKey }), [userKey]);\n\n  // Input state (managed internally for stub)\n  const [inputValue, setInputValueInternal] = React.useState(initialInputValue);\n\n  // Thread input context\n  const threadInputContext = useMemo<TamboV1ThreadInputContextProps>(() => {\n    const setValue: React.Dispatch<React.SetStateAction<string>> =\n      onSetValue ?? setInputValueInternal;\n\n    const submit: TamboV1ThreadInputContextProps[\"submit\"] =\n      onSubmit ??\n      (async () => {\n        return { threadId };\n      });\n\n    return {\n      value: inputValue,\n      setValue,\n      submit,\n      threadId,\n      setThreadId: () => {},\n      images: [],\n      addImage: async () => {},\n      addImages: async () => {},\n      removeImage: () => {},\n      clearImages: () => {},\n      isPending: false,\n      isError: false,\n      error: null,\n      isIdle: true,\n      isSuccess: false,\n      status: \"idle\",\n      data: undefined,\n      variables: undefined,\n      failureCount: 0,\n      failureReason: null,\n      reset: () => {},\n      context: undefined,\n      submittedAt: 0,\n      isPaused: false,\n    };\n  }, [inputValue, threadId, onSubmit, onSetValue, setInputValueInternal]);\n\n  // Registry context\n  const registryContext = useMemo<TamboRegistryContext>(\n    () => ({\n      componentList,\n      toolRegistry,\n      componentToolAssociations: {},\n      mcpServerInfos: [],\n      resources: [],\n      resourceSource: null,\n      onCallUnregisteredTool: undefined,\n      registerComponent: () => {},\n      registerTool: () => {},\n      registerTools: () => {},\n      addToolAssociation: () => {},\n      registerMcpServer: () => {},\n      registerMcpServers: () => {},\n      registerResource: () => {},\n      registerResources: () => {},\n      registerResourceSource: () => {},\n    }),\n    [componentList, toolRegistry],\n  );\n\n  // Client context\n  const clientContext = useMemo(\n    () => ({\n      client: stubClient,\n      queryClient,\n      isUpdatingToken: false,\n    }),\n    [stubClient, queryClient],\n  );\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TamboClientContext.Provider value={clientContext}>\n        <TamboRegistryContext.Provider value={registryContext}>\n          <TamboV1ConfigContext.Provider value={config}>\n            <TamboV1StreamProvider\n              state={streamState}\n              dispatch={streamDispatch}\n              threadManagement={threadManagement}\n            >\n              <TamboV1ThreadInputContext.Provider value={threadInputContext}>\n                {children}\n              </TamboV1ThreadInputContext.Provider>\n            </TamboV1StreamProvider>\n          </TamboV1ConfigContext.Provider>\n        </TamboRegistryContext.Provider>\n      </TamboClientContext.Provider>\n    </QueryClientProvider>\n  );\n}\n"]}
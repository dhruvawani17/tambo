{"version":3,"file":"tambo-v1-stream-context.test.js","sourceRoot":"","sources":["../../../src/v1/providers/tambo-v1-stream-context.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import { EventType, type RunStartedEvent } from \"@ag-ui/core\";\nimport { renderHook, act } from \"@testing-library/react\";\nimport React from \"react\";\nimport {\n  TamboV1StreamProvider,\n  useStreamState,\n  useStreamDispatch,\n  useThreadManagement,\n} from \"./tambo-v1-stream-context\";\n\ndescribe(\"TamboV1StreamProvider\", () => {\n  describe(\"useStreamState\", () => {\n    it(\"throws when used outside provider\", () => {\n      // Suppress console.error for expected error\n      const consoleSpy = jest\n        .spyOn(console, \"error\")\n        .mockImplementation(() => {});\n\n      expect(() => {\n        renderHook(() => useStreamState());\n      }).toThrow(\"useStreamState must be used within TamboV1StreamProvider\");\n\n      consoleSpy.mockRestore();\n    });\n\n    it(\"returns initial state with empty threadMap\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(() => useStreamState(), { wrapper });\n\n      expect(result.current.threadMap).toEqual({});\n      expect(result.current.currentThreadId).toBeNull();\n    });\n\n    it(\"initializes thread via dispatch\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          dispatch: useStreamDispatch(),\n        }),\n        { wrapper },\n      );\n\n      act(() => {\n        result.current.dispatch({\n          type: \"INIT_THREAD\",\n          threadId: \"thread_123\",\n        });\n      });\n\n      expect(result.current.state.threadMap.thread_123).toBeDefined();\n      expect(result.current.state.threadMap.thread_123.thread.id).toBe(\n        \"thread_123\",\n      );\n      expect(result.current.state.threadMap.thread_123.thread.status).toBe(\n        \"idle\",\n      );\n      expect(result.current.state.threadMap.thread_123.thread.messages).toEqual(\n        [],\n      );\n    });\n\n    it(\"initializes thread with initial data via dispatch\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          dispatch: useStreamDispatch(),\n        }),\n        { wrapper },\n      );\n\n      act(() => {\n        result.current.dispatch({\n          type: \"INIT_THREAD\",\n          threadId: \"thread_123\",\n          initialThread: {\n            title: \"Test Thread\",\n            metadata: { key: \"value\" },\n          },\n        });\n      });\n\n      expect(result.current.state.threadMap.thread_123.thread.title).toBe(\n        \"Test Thread\",\n      );\n      expect(result.current.state.threadMap.thread_123.thread.metadata).toEqual(\n        {\n          key: \"value\",\n        },\n      );\n      // Default values should still be set\n      expect(result.current.state.threadMap.thread_123.thread.status).toBe(\n        \"idle\",\n      );\n    });\n  });\n\n  describe(\"useStreamDispatch\", () => {\n    it(\"throws when used outside provider\", () => {\n      const consoleSpy = jest\n        .spyOn(console, \"error\")\n        .mockImplementation(() => {});\n\n      expect(() => {\n        renderHook(() => useStreamDispatch());\n      }).toThrow(\"useStreamDispatch must be used within TamboV1StreamProvider\");\n\n      consoleSpy.mockRestore();\n    });\n\n    it(\"dispatches events to update state\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          dispatch: useStreamDispatch(),\n        }),\n        { wrapper },\n      );\n\n      // Initialize the thread first\n      act(() => {\n        result.current.dispatch({\n          type: \"INIT_THREAD\",\n          threadId: \"thread_123\",\n        });\n      });\n\n      const runStartedEvent: RunStartedEvent = {\n        type: EventType.RUN_STARTED,\n        runId: \"run_1\",\n        threadId: \"thread_123\",\n      };\n\n      act(() => {\n        result.current.dispatch({\n          type: \"EVENT\",\n          event: runStartedEvent,\n          threadId: \"thread_123\",\n        });\n      });\n\n      expect(result.current.state.threadMap.thread_123.thread.status).toBe(\n        \"streaming\",\n      );\n      expect(result.current.state.threadMap.thread_123.streaming.status).toBe(\n        \"streaming\",\n      );\n      expect(result.current.state.threadMap.thread_123.streaming.runId).toBe(\n        \"run_1\",\n      );\n    });\n  });\n\n  describe(\"useThreadManagement\", () => {\n    it(\"throws when used outside provider\", () => {\n      const consoleSpy = jest\n        .spyOn(console, \"error\")\n        .mockImplementation(() => {});\n\n      expect(() => {\n        renderHook(() => useThreadManagement());\n      }).toThrow(\n        \"useThreadManagement must be used within TamboV1StreamProvider\",\n      );\n\n      consoleSpy.mockRestore();\n    });\n\n    it(\"initThread creates a new thread\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          management: useThreadManagement(),\n        }),\n        { wrapper },\n      );\n\n      act(() => {\n        result.current.management.initThread(\"thread_456\");\n      });\n\n      expect(result.current.state.threadMap.thread_456).toBeDefined();\n      expect(result.current.state.threadMap.thread_456.thread.id).toBe(\n        \"thread_456\",\n      );\n    });\n\n    it(\"switchThread changes currentThreadId\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          management: useThreadManagement(),\n        }),\n        { wrapper },\n      );\n\n      // Initialize and switch to a thread\n      act(() => {\n        result.current.management.initThread(\"thread_789\");\n        result.current.management.switchThread(\"thread_789\");\n      });\n\n      expect(result.current.state.currentThreadId).toBe(\"thread_789\");\n    });\n\n    it(\"startNewThread creates temp thread and switches to it\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          management: useThreadManagement(),\n        }),\n        { wrapper },\n      );\n\n      let tempId: string;\n      act(() => {\n        tempId = result.current.management.startNewThread();\n      });\n\n      expect(tempId!).toMatch(/^temp_/);\n      expect(result.current.state.currentThreadId).toBe(tempId!);\n      expect(result.current.state.threadMap[tempId!]).toBeDefined();\n    });\n  });\n});\n"]}
{"version":3,"file":"json-schema.js","sourceRoot":"","sources":["../../src/schema/json-schema.ts"],"names":[],"mappings":"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","sourcesContent":["import { JSONSchema7 } from \"json-schema\";\nimport { z } from \"zod/v4\";\n\nconst jsonSchemaType = z.union([\n  z.literal(\"object\"),\n  z.literal(\"array\"),\n  z.literal(\"string\"),\n  z.literal(\"number\"),\n  z.literal(\"integer\"),\n  z.literal(\"boolean\"),\n  z.literal(\"null\"),\n  z.array(\n    z.union([\n      z.literal(\"object\"),\n      z.literal(\"array\"),\n      z.literal(\"string\"),\n      z.literal(\"number\"),\n      z.literal(\"integer\"),\n      z.literal(\"boolean\"),\n      z.literal(\"null\"),\n    ]),\n  ),\n]);\n\nconst jsonSchemaTopLevel = z\n  .looseObject({\n    type: jsonSchemaType.optional(),\n    properties: z.record(z.string(), z.unknown()).optional(),\n    items: z.union([z.array(z.unknown()), z.unknown()]).optional(),\n    required: z.array(z.string()).optional(),\n    additionalProperties: z.union([z.boolean(), z.unknown()]).optional(),\n    enum: z.array(z.unknown()).optional(),\n    const: z.unknown().optional(),\n    $ref: z.string().optional(),\n    $id: z.string().optional(),\n    $schema: z.string().optional(),\n    title: z.string().optional(),\n    description: z.string().optional(),\n  })\n  .refine((value) => {\n    return (\n      value.type !== undefined ||\n      value.properties !== undefined ||\n      value.items !== undefined ||\n      value.enum !== undefined ||\n      value.const !== undefined ||\n      value.$ref !== undefined\n    );\n  });\n\n/**\n * Basic heuristic to check if an object looks like a JSON Schema at the top level.\n *\n * This uses a Zod schema to verify only top-level keys (type, properties, items,\n * etc.). It intentionally does not perform full JSON Schema validation; a more\n * thorough check should be done server-side.\n * @param obj - The value to check\n * @returns True if the value appears to be a JSON Schema\n */\nexport function looksLikeJSONSchema(obj: unknown): obj is JSONSchema7 {\n  if (obj === null || typeof obj !== \"object\") {\n    return false;\n  }\n\n  return jsonSchemaTopLevel.safeParse(obj).success;\n}\n\n/**\n * Extended JSON Schema type that includes draft 2020-12 features like prefixItems.\n * The json-schema package types are from draft-07 and don't include prefixItems.\n */\nexport type JSONSchema7Extended = JSONSchema7 & {\n  prefixItems?: JSONSchema7[];\n};\n\n/**\n * Checks if a JSON Schema represents a tuple (array with positional items).\n * Supports both draft-07 (items as array) and draft 2020-12 (prefixItems).\n * @param schema - The JSON Schema to check\n * @returns True if the schema represents a tuple\n */\nexport function isJsonSchemaTuple(\n  schema: JSONSchema7Extended,\n): schema is JSONSchema7Extended & { type: \"array\" } {\n  if (schema.type !== \"array\") {\n    return false;\n  }\n\n  // Draft 2020-12: prefixItems array\n  if (schema.prefixItems && Array.isArray(schema.prefixItems)) {\n    return true;\n  }\n\n  // Draft-07: items as array (not object)\n  if (Array.isArray(schema.items)) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Gets the tuple items from a JSON Schema.\n * Supports both draft-07 (items as array) and draft 2020-12 (prefixItems).\n * @param schema - The JSON Schema tuple\n * @returns Array of item schemas, or undefined if not a tuple\n */\nexport function getJsonSchemaTupleItems(\n  schema: JSONSchema7Extended,\n): JSONSchema7[] | undefined {\n  if (schema.type !== \"array\") {\n    return undefined;\n  }\n\n  // Draft 2020-12: prefixItems array\n  if (schema.prefixItems && Array.isArray(schema.prefixItems)) {\n    return schema.prefixItems;\n  }\n\n  // Draft-07: items as array\n  if (Array.isArray(schema.items)) {\n    return schema.items as JSONSchema7[];\n  }\n\n  return undefined;\n}\n\n/**\n * Creates a partial version of a JSON Schema by removing required constraints.\n * This allows LLM to provide only the properties it wants to update.\n * @param schema - The JSON Schema to make partial\n * @returns A new JSON Schema with the required constraint removed\n */\nexport function makeJsonSchemaPartial(schema: JSONSchema7): JSONSchema7 {\n  const { required: _required, ...rest } = schema;\n  return rest;\n}\n"]}